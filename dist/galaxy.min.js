function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Galaxy={})})(this,function(a){"use strict";function b(a,b){return b={exports:{}},a(b,b.exports),b.exports}function c(a){return null!==a&&"object"==typeof a}function d(a){return a.nodeType===Node.TEXT_NODE}function e(a){return a.nodeType===Node.ELEMENT_NODE}function f(a){return"function"==typeof a}function g(a){return null!=a}function h(a){return a.startsWith("$")||a.startsWith("_")}function i(a){return a.constructor[ma]||!1}function j(a){const b=a.split(S);return 1<b.length?`_$f(${b[0]}, [${k(b.slice(1)).join()}])`:a}function k(a){return a.map(a=>{const{groups:b}=T.exec(a.trim());return`{      name: '${b.name}',      args: ${b.args?`[${b.args}]`:"null"}    }`})}function l(a){let b;const c=[];for(;b=U.exec(a);){const d=a.slice(0,b.index);let e=b.groups.expression.trim();d&&c.push(`\`${d}\``),e&&c.push(`_$n(${j(e)})`),a=a.slice(b.index+b[0].length)}return a&&c.push(`\`${a}\``),c.join(" + ")}function m(a){let b,c=a;for(;b=V.exec(a);){const{index:d,groups:e}=b,f=d+b[0].length;let g=1,h=f,i=!1,j=!1;loop:for(;g;){const b=!i&&!j;switch(a.charCodeAt(h++)){case 40:b&&++g;break;case 41:b&&--g;break;case 34:j||(i=!i);break;case 39:i||(j=!j);break;case NaN:break loop;}}const k=a.slice(f,h-1);c=c.replace(a.slice(d,h),`$commit('${e.name}'${k?`, ${k}`:""})`)}return c}function n(a){return q(l(a))}function o(a){return q(j(a))}function p(a){return s(m(a))}function q(a){return s(`return ${a}`)}function r(a){return s(`(${a} = __args__[0])`)}function s(a){let b=W.get(a);return b||(b=new Function("__global__","__locals__","...__args__",`with (__global__) {        with (this) {          with (state) {            with (__locals__) {              ${a}            }          }        }      }`),W.set(a,b)),(a,c,...d)=>b.call(a,R,c,...d)}function t(a){a=$(a);const b=a.replace(ca,u("[\\w-]+"));return new RegExp(`^${b===a?u(a):b}(?:.(?<args>.+))?$`)}function u(a){return`(?${"<name>"}${a})`}function v(a){return a.replace(aa,(a,b)=>b.toUpperCase())}function w(a){return a.replace(ba,(a,b)=>`-${b.toLowerCase()}`).toLowerCase()}function x(a,b,c=_){const d=c(a.getAttribute(b));return N.debug||a.removeAttribute(b),d}function y(a){return N.debug?new Comment(` ${a} `):new Text}function z(...a){return Object.assign(Object.create(null),...a)}function A(a,b){return a.nodeValue!==b}function B(a){const b=[];return a.childrenRenderer.renderers.forEach(a=>{b.push(...(a.isFlattenable?B(a):[a]))}),b}function C(a){return a.is||a.name&&w(a.name)}function D(a,b,c){a.$emit(`$${b}`,c),b=a[`on${b.charAt(0).toUpperCase()+b.slice(1)}`],f(b)&&P.afterFlush(()=>{b.call(a,c)})}function E(a,b){return a[b]||[]}function F(a,b){return Object.assign(a.prototype,...b)}function G(a){return(...b)=>{let c=0;const d=(...b)=>{const e=a[c++];e&&e(d,...b)};d(...b)}}function H({message:a,stack:b}){const c=new ka(a);return c.stack=b,c}function I(a){class b extends a{constructor(){super(),_defineProperty(this,"$refs",Object.create(null)),_defineProperty(this,"$events",Object.create(null)),_defineProperty(this,"$parent",null),_defineProperty(this,"$rendering",!1);let a;const{style:b,template:c}=this.constructor;try{a=this.attachShadow({mode:"open"})}catch(a){}if(b instanceof HTMLStyleElement){if(!a)throw new ka("style cannot be attached");a.appendChild(b.cloneNode(!0))}if(c instanceof HTMLTemplateElement){if(!a)throw new ka("template cannot be attached");a.appendChild(c.content.cloneNode(!0))}this.$name=C(this.constructor),this.state={},this.$renderer=new ia(a?a.childNodes:[],this,{}),D(this,"created")}get state(){return la.get(this)}set state(a){const b=()=>{this.$render()};la.set(this,Q.observe(a,null,b)),b()}connectedCallback(){let a=this;do a=a instanceof ShadowRoot?a.host:a.parentNode;while(a&&!i(a));this.$parent=a,D(this,"attached")}disconnectedCallback(){this.$parent=null,D(this,"detached")}attributeChangedCallback(a,b,c){D(this,"attribute",{name:a,old:b,value:c})}$commit(a,...b){if(a in this){if(!f(this[a]))throw new ka(`Method '${a}' must be a function`);if(h(a))throw new ka(`Could no call reserved method '${a}'`);this[a](this.state,...b)}}$render(){this.$rendering||(this.$emit("$render:before"),this.$rendering=!0,P(()=>{let a;try{this.$renderer.render()}catch(b){if(b instanceof ka||(b=H(b)),N.debug)throw b;a=b}this.$rendering=!1,a&&this.$emit("$render:error",a)}))}}return b.extendsBuiltIn=a!==HTMLElement,b.resolved=!1,b[ma]=!0,F(b,[ja]),b}function J(a){Object.assign(N,a),"plugins"in N&&M(a.plugins),N.directives.unshift(...[pa,qa,ra,sa,ua,va,ta,xa,ya,za,Aa]);for(const b of N.directives)b._matcher=t(b.is);if(!N.root)throw new ka("You must include a `root` option");L([N.root])}function K(a,...b){const c=document.createElement(a);return c.innerHTML=String.raw(...b),c}function L(a){const b=[];for(const c of a){if(c.resolved)continue;let a=[];const d={},e=C(c);if(!e)throw new ka("Unknown element tag name");if(c.extendsBuiltIn&&!(d.extends=c.extends))throw new ka("Extended customized built-in elements must have an `extends` property");Array.isArray(c.children)&&(a=L(c.children));try{b.push(customElements.whenDefined(e)),c.resolved=!0,Promise.all(a).then(()=>{customElements.define(e,c,d)})}catch(a){throw H(a)}}return b}function M(a){const b=Object.assign.bind(null,Ba.prototype);for(const c in a){const d=a[c];if(null!==d&&"object"==typeof d)b(d);else if("function"==typeof d)d(Ba);else throw new ka(`plugin '${c}' must be an object or function`)}}var N={root:null,debug:!0,plugins:{},filters:{},directives:[]},O="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,P=b(function(a){(function(b,c){a.exports=c()})(O,function(){function a(d){a.waiting||b.then(a.flush),c.push(d)}const b=Promise.resolve(),c=a.queue=[];return Object.defineProperty(a,"waiting",{enumerable:!0,get(){return 0<c.length}}),a.afterFlush=b=>{setTimeout(()=>a.waiting?void a.afterFlush(b):b())},a.flush=()=>{if(a.waiting){const a=c.slice();c.length=0;for(const b of a)b()}},a})}),Q=b(function(a){(function(b,c){a.exports=c()})(O,function(){const a=new WeakMap,b=Object.prototype.hasOwnProperty,c=a=>"[object Object]"===Object.prototype.toString.call(a)||Array.isArray(a),d=()=>{};class e{constructor(a){this.target=a,this.subscribers=new Set}static get observeOptions(){return{deep:!0,compare(a,b){return JSON.stringify(a)!==JSON.stringify(b)}}}static is(b){return c(b)&&a.has(b)}static get(b){return a.get(b)}static observe(f,g={},h=d){function i(a){h(a),l.dispatch(a)}if(e.is(f))return f;const{deep:j,compare:k}=Object.assign({},e.observeOptions,g),l=new e(f);if(j)for(const a in f)if(b.call(f,a)){const b=f[a];c(b)&&(f[a]=e.observe(b,g,i))}const m=new Proxy(f,{defineProperty(a,d,f){const{value:h}=f,l=a[d],m=b.call(a,d);j&&c(h)&&(f.value=e.observe(h,g,i));const n=Reflect.defineProperty(a,d,f);if(n&&(!m||k(h,l,d,a))){const b={type:m?"set":"add",value:h,property:d,target:a};m&&(b.old=l),i(b)}return n},deleteProperty(a,c){const d=a[c],e=b.call(a,c)&&Reflect.deleteProperty(a,c);return e&&i({type:"delete",old:d,property:c,target:a}),e}});return a.set(f,l),a.set(m,l),m}subscribe(a){return this.subscribers.add(a),this}unsubscribe(a){return this.subscribers.delete(a),this}dispatch(a){return this.subscribers.forEach(b=>{b(a,this.target)}),this}}return e})}),R={_$f(a,b){return b.reduce((a,b)=>{const c=N.filters[b.name];return b.args?c(a,...b.args):c(a)},a)},_$n(a){return g(a)?a:""}};const S=/(?<!\|)\|(?!\|)/,T=/^(?<name>\w+)(?:\((?<args>.*)\))?$/,U=/{{(?<expression>.*?)}}/,V=/#(?<name>\w+)\(/g,W=new Map;class X{constructor(a,b){this.node=a,this.renderer=b,this.getter=n(a.nodeValue)}static is({nodeValue:a}){return U.test(a)}render(){const a=this.getter(this.renderer.scope,this.renderer.isolated);this.node.nodeValue!==a&&(this.node.nodeValue=a)}}class Y{constructor(a,b,c){this.scope=b,this.element=a,this.isolated=c,this.locals=Object.create(null),this.directives=[],this._init(a)}get isRenderable(){return this.directives.length}_init(a){const b=Array.from(a.attributes);for(const c of b){const{name:b,value:d}=c;X.is(c)&&this.directives.push(new X(c,this));for(const c of N.directives){const e=c._match(b,a);if(e){const f={name:e.name,args:e.args?e.args.split("."):[],value:d};if(c.match(f,this)){const d=new c(f,this);d.init(),d.$options.$render&&this.directives.push(d),N.debug||a.removeAttribute(b);break}}}}}render(){for(const a of this.directives)a.render()}}var Z=/[|\\{}()[\]^$+*?.]/g,$=function(a){if("string"!=typeof a)throw new TypeError("Expected a string");return a.replace(Z,"\\$&")};const _=a=>a,aa=/-([a-z0-9])/gi,ba=/(?<=[a-z0-9])([A-Z])/g,ca="<name>";class da extends Y{constructor(a,b,c){super(a,b,z(c)),this.childrenRenderer=new ia(a.childNodes,b,this.isolated)}get isRenderable(){return super.isRenderable||0<this.childrenRenderer.renderers.length}get isFlattenable(){return 0<this.childrenRenderer.renderers.length&&!this.directives.length}render(){super.render(),this.element.isConnected&&this.childrenRenderer.render()}}class ea extends da{constructor(a,b,c){super(a.cloneNode(!0),b.scope,z(b.isolated,c)),this.reused=!1;const d=o(this.element.getAttribute("by"));this.by=a=>d(this.scope,z(this.isolated,a))}get key(){return this.by()}get next(){return this.element.nextSibling}update(a){this.reused=!0,Object.assign(this.isolated,a)}insert(a){a.before(this.element)}remove(){this.element.remove()}}const fa="*for",ga=/^\(?(?<value>\w+)(?:\s*,\s*(?<key>\w+)(?:\s*,\s*(?<index>\w+))?)?\)?\s+(?:in|of)\s+(?<expression>.+)$/;class ha{constructor(a,b){this.template=a,this.renderer=b,this.items=[],this.values=new Map;const c=x(a,fa),{groups:d}=c.match(ga);this.keyName=d.key,this.indexName=d.index,this.valueName=d.value,this.startAnchor=y(`start for: ${c}`),this.endAnchor=y(`end for: ${c}`),this.getter=o(d.expression),a.replaceWith(this.startAnchor),this.startAnchor.nextSibling.before(this.endAnchor),a.hasAttribute("by")||(N.debug&&console.warn("The element with the loop expression `"+c+"` doesn't have a `by` attribute, fallbacking to `$index` tracking."),a.setAttribute("by","$index"))}static is({attributes:a}){return fa in a}render(){const a=this.getter(this.renderer.scope,this.renderer.isolated),b=[],c=Object.keys(a);c.forEach((c,d)=>{let e=this.items[d];const f={$index:d,$key:c,[this.keyName]:c,[this.indexName]:d,[this.valueName]:a[c]};if(!e)e=new ea(this.template,this.renderer,f),e.insert(this.endAnchor),this.values.set(e.key,e);else{const a=e.by(f);if(e.key!==a){const b=this.values.get(a),c=b.next;b.insert(e.next),e.insert(c),this.items[this.items.indexOf(b)]=e,this.items[d]=b,e=b}e.update(f)}b.push(e),e.render()});for(const a of this.items)a.reused?a.reused=!1:(this.values.delete(a.key.value),a.remove());this.items=b}}class ia{constructor(a,b,c){this.children=Array.from(a),this.scope=b,this.isolated=c,this.renderers=[],this._init()}_init(){for(const a of this.children)if(d(a)&&X.is(a))this.renderers.push(new X(a,this));else if(e(a))if(ha.is(a))this.renderers.push(new ha(a,this));else{const b=new(a.childNodes.length?da:Y)(a,this.scope,this.isolated);b.isRenderable&&this.renderers.push(...(b.isFlattenable?B(b):[b]))}}render(){for(const a of this.renderers)a.render()}}var ja={$on(a,b,c){(this.$events[a]=E(this.$events,a)).push(b),this.addEventListener(a,b,c)},$once(a,b,c){const d=c=>{this.$off(a,d),b(c)};d.listener=b,this.$on(a,d,c)},$off(a,b){switch(arguments.length){case 0:for(a in this.$events)this.$off(a);break;case 1:for(const b of E(this.$events,a))this.$off(a,b);break;default:{const c=E(this.$events,a).filter(a=>a!==b);c.length?this.$events[a]=c:delete this.$events[a],this.removeEventListener(a,b)}}},$emit(a,b){this.dispatchEvent(a instanceof Event?a:new CustomEvent(a,{detail:b}))}};class ka extends Error{}const la=new WeakMap,ma=Symbol("GalaxyElement"),na={$plain:!1,$render:!0};class oa{constructor(a,b){if(this.$name=a.name,this.$args=a.args,this.$value=a.value,this.$renderer=b,this.$scope=b.scope,this.$element=b.element,this.$options=Object.assign({},na,this.constructor.options),!this.$options.$plain){const c=o(a.value);this.$getter=a=>c(b.scope,z(b.isolated,a))}}static get is(){return""}static match(){return!0}init(){}render(){}}oa._matcher=null,oa._match=function(a){const b=this._matcher.exec(a);return b&&b.groups};class pa extends oa{static get is(){return"*if"}init(){this.anchor=y(`if: ${this.$value}`)}render(){const{isConnected:a}=this.$element;this.$getter()?!a&&this.anchor.replaceWith(this.$element):a&&this.$element.replaceWith(this.anchor)}}class qa extends oa{static get is(){return"@<name>"}static get options(){return{$plain:!0,$render:!1}}init(){const{$args:a,$scope:b,$name:c,$element:d,$renderer:e}=this,f=a.includes("once"),g=p(this.$value);let h;const j=[];let k="addEventListener";a.includes("self")&&j.push((a,b)=>{b.target===b.currentTarget&&a(b)}),a.includes("prevent")&&j.push((a,b)=>{b.preventDefault(),a(b)}),i(d)?k=`$on${f?"ce":""}`:f&&j.push((a,b)=>{d.removeEventListener(c,h),a(b)}),j.push((a,c)=>{g(b,z(e.isolated,{$event:c})),a()}),d[k](c,h=G(j))}}class ra extends oa{static get is(){return".<name>"}init(){this._inCustom=i(this.$element),this.$element[this.$name]=null}render(){this.$element[this.$name]=this.$getter(),this._inCustom&&this.$element.$render()}}class sa extends oa{static get is(){return"ref"}init(){this.refName=v(this.$value)}render(){const{$scope:a,$element:b,refName:c}=this;b.isConnected?a.$refs[c]=b:delete a.$refs[c]}}class ta extends oa{static get is(){return":<name>"}_getObserved(){let a=this.$element.getAttributeNode(this.$name);return N.debug||this.$element.removeAttribute(this.$name),a||(a=document.createAttribute(this.$name),this.$element.setAttributeNode(a)),a}init(){this.attribute=this._getObserved()}render(){const a=this.$getter();"boolean"==typeof a?this.element[`${a?"set":"remove"}AttributeNode`](this.attribute):A(this.attribute,a)&&(this.attribute.value=a)}}class ua extends ta{static get is(){return":class"}_getNormalized(){const a=this.$getter();if(!Array.isArray(a))return a;return a.forEach(a=>{c(a)?Object.assign(result,a):result[a]=1}),{}}render(){const a=this._getNormalized();if(!c(a))return super.render();for(const b in a)a.hasOwnProperty(b)&&this.$element.classList[a[b]?"add":"remove"](b)}}class va extends ta{static get is(){return":style"}static parseRule(a){const b=a.split(".");return{prop:b[0],unit:b[1]}}init(){this.styles={}}render(){const a=this.$getter();if(!c(a))return super.render();const b=this.$element.attributeStyleMap;for(const c in this.styles)a.hasOwnProperty(c)||b.delete(va.parseRule(c).prop);for(const c in a){const d=a[c];if(this.styles[c]!==d){const{prop:a,unit:e}=va.parseRule(c);b.set(a,e?CSS[e](d):d)}}this.styles=Object.assign({},a)}}class wa extends oa{static get is(){return"*bind"}init(){this.setting=!1;const a=r(this.$value);this.setter=b=>{a(this.$scope,this.$renderer.isolated,b)},this.onInput&&this.$element.addEventListener("input",this.onInput.bind(this)),this.onChange&&this.$element.addEventListener("change",this.onChange.bind(this))}static setMultiple(a,b,c){const d=c.indexOf(b);a?-1===d&&c.push(b):-1<d&&c.splice(d,1)}setValue(a){this.setting=!0,this.setter(a)}render(){this.setting?this.setting=!1:this.update(this.$element,this.$getter())}}class xa extends wa{static match(a,{element:b}){return"checkbox"===b.type}onChange({target:a}){const b=this.$getter();return Array.isArray(b)?void wa.setMultiple(a.checked,a.value,b):this.setValue(a.checked)}update(a,b){a.checked=!!b}}class ya extends wa{static match(a,{element:b}){return"radio"===b.type}onChange({target:a}){a.checked&&this.setValue(a.value)}update(a,b){a.checked=b+""===a.value}}class za extends wa{static match(a,{element:b}){return b instanceof HTMLInputElement||b instanceof HTMLTextAreaElement}init(){switch(super.init(),this.valueKey="value",this.$args[0]){case"number":this.valueKey+="AsNumber";break;case"date":this.valueKey+="AsDate";}}onInput({target:a}){this.setValue(a[this.valueKey])}update(a,b){a[this.valueKey]!==b&&(a[this.valueKey]=b)}}class Aa extends wa{static match(a,{element:b}){return b instanceof HTMLSelectElement}onChange({target:a}){const{options:b,multiple:c}=a;if(!c){for(const{value:a,selected:c}of b)if(c)return this.setValue(a);}else{const a=this.$getter();if(!Array.isArray(a))throw new ka("Invalid bound value. *bind directive on select elements with a `multiple` attribute must have an array bound value.");for(const c of b)wa.setMultiple(c.selected,c.value,a)}}update(a,b){for(const c of a.options)c.selected=a.multiple?-1<b.indexOf(c.value):b===c.value}}const Ba=I(HTMLElement);a.extend=I,a.config=N,a.GalaxyElement=Ba,a.html=function(...a){return K("template",...a)},a.css=function(...a){const b=K("style",...a);return b.setAttribute("skip",""),b},a.setup=J,a.GalaxyDirective=oa,Object.defineProperty(a,"__esModule",{value:!0})});