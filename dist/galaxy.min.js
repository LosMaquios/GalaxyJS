function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Galaxy={})})(this,function(a){"use strict";function b(a,b){return b={exports:{}},a(b,b.exports),b.exports}function c(a){return null!==a&&"object"==typeof a}function d(a){return a.nodeType===Node.TEXT_NODE}function e(a){return a.nodeType===Node.ELEMENT_NODE}function f(a){return"function"==typeof a}function g(a){return null!=a}function h(a){return a.startsWith("$")||a.startsWith("_")}function i(a){return a instanceof HTMLTemplateElement}function j(a){return!!a.$galaxy}function k(a){const b=a.split(T);return 1<b.length?`_$f(${b[0]}, [${l(b.slice(1)).join()}])`:a}function l(a){return a.map(a=>{const{groups:b}=U.exec(a.trim());return`{      name: '${b.name}',      args: ${b.args?`[${b.args}]`:"null"}    }`})}function m(a){let b;const c=[];for(;b=V.exec(a);){const d=a.slice(0,b.index);let e=b.groups.expression.trim();d&&c.push(`\`${d}\``),e&&c.push(`_$n(${k(e)})`),a=a.slice(b.index+b[0].length)}return a&&c.push(`\`${a}\``),c.join(" + ")}function n(a){let b,c=a;for(;b=W.exec(a);){const{index:d,groups:e}=b,f=d+b[0].length;let g=1,h=f,i=!1,j=!1;loop:for(;g;){const b=!i&&!j;switch(a.charCodeAt(h++)){case 40:b&&++g;break;case 41:b&&--g;break;case 34:j||(i=!i);break;case 39:i||(j=!j);break;case NaN:break loop;}}const k=a.slice(f,h-1);c=c.replace(a.slice(d,h),`$commit('${e.name}'${k?`, ${k}`:""})`)}return c}function o(a){return r(m(a))}function p(a){return r(k(a))}function q(a){return t(n(a))}function r(a){return t(`return ${a}`)}function s(a){return t(`(${a} = __args__[0])`)}function t(a){let b=X.get(a);return b||(b=new Function("__global__","__locals__","...__args__",`with (__global__) {        with (this) {          with (state) {            with (__locals__) {              ${a}            }          }        }      }`),X.set(a,b)),(a,c,...d)=>b.call(a,S,c,...d)}function u(a){a=_(a);const b=a.replace(da,v("[:\\w-]+"));return new RegExp(`^${b===a?v(a):b}(?:.(?<args>.+))?$`)}function v(a){return`(?${"<name>"}${a})`}function w(a){return a.replace(ba,(a,b)=>b.toUpperCase())}function x(a){return a.replace(ca,(a,b)=>`-${b.toLowerCase()}`).toLowerCase()}function y(a,b,c=aa){const d=c(a.getAttribute(b));return O.debug||a.removeAttribute(b),d}function z(a){return O.debug?new Comment(` ${a} `):new Text}function A(...a){return Object.assign(Object.create(null),...a)}function B(a,b){return a.nodeValue!==b}function C(a){const b=[];return a.childrenRenderer.renderers.forEach(a=>{b.push(...(a.isFlattenable?C(a):[a]))}),b}function D(a,b,c){a.$emit(`$${b}`,c),b=a[`on${b.charAt(0).toUpperCase()+b.slice(1)}`],f(b)&&Q.afterFlush(()=>{b.call(a,c)})}function E(a,b){return a[b]||[]}function F(a,b,c){const d=E(a,b).filter(a=>a!==c);d.length?a[b]=d:delete a[b]}function G(a,b){return Object.assign(a.prototype,...b)}function H(a){return(...b)=>{let c=0;const d=(...b)=>{const e=a[c++];e&&e(d,...b)};d(...b)}}function I(a){const b=p(a.getAttribute("by"));return function(a){return b(this.scope,A(this.isolated,a))}}function J({message:a,stack:b}){const c=new la(a);return c.stack=b,c}function K(a){class b extends a{static get is(){return x(this.name)}get $name(){return this.constructor.is}static get children(){return[]}constructor(){super(),_defineProperty(this,"$refs",Object.create(null)),_defineProperty(this,"$events",Object.create(null)),_defineProperty(this,"$parent",null),_defineProperty(this,"$rendering",!1);let a;const{style:b,template:c}=this.constructor;try{a=this.attachShadow({mode:"open"})}catch(a){}if(b instanceof HTMLStyleElement){if(!a)throw new la("style cannot be attached");a.appendChild(b.cloneNode(!0))}if(c instanceof HTMLTemplateElement){if(!a)throw new la("template cannot be attached");a.appendChild(c.content.cloneNode(!0))}this.state={},this.$renderer=new ja(a?a.childNodes:[],this,{}),D(this,"created")}get state(){return ma.get(this)}set state(a){const b=()=>{this.$render()};ma.set(this,R.observe(a,null,b)),b()}connectedCallback(){let a=this;do a=a instanceof ShadowRoot?a.host:a.parentNode;while(a&&!j(a));this.$parent=a,D(this,"attached")}disconnectedCallback(){this.$parent=null,D(this,"detached")}attributeChangedCallback(a,b,c){D(this,"attribute",{name:a,old:b,value:c})}$commit(a,...b){if(a in this){if(!f(this[a]))throw new la(`Method '${a}' must be a function`);if(h(a))throw new la(`Could no call reserved method '${a}'`);this[a](this.state,...b)}}$render(){this.$rendering||(this.$emit("$render:before"),this.$rendering=!0,Q(()=>{let a;try{this.$renderer.render()}catch(b){if(b instanceof la||(b=J(b)),O.debug)throw b;a=b}this.$rendering=!1,a&&this.$emit("$render:error",a)}))}}return b.extendsBuiltIn=a!==HTMLElement,b.resolved=!1,b.prototype.$galaxy=b.$galaxy=!0,G(b,[ka]),b}function L(a,...b){const c=document.createElement(a);return c.innerHTML=String.raw(...b),c}function M(a,b){const c=[];for(const d of a){if(d.resolved)continue;const a={},e=d.is;if(!e)throw new la("Unknown element tag name");if(d.extendsBuiltIn&&!(a.extends=d.extends))throw new la("Extended customized built-in elements must have an `extends` property");try{c.push(customElements.whenDefined(e)),N(d,b),Promise.all(M(d.children,b)).then(()=>{customElements.define(e,d,a)}),d.resolved=!0}catch(a){throw J(a)}}return c}function N(a,b){for(const c of b)c.install(a)}var O={root:null,debug:!0,elements:[],directives:[],plugins:[],filters:{}},P="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,Q=b(function(a){(function(b,c){a.exports=c()})(P,function(){function a(d){a.waiting||b.then(a.flush),c.push(d)}const b=Promise.resolve(),c=a.queue=[];return Object.defineProperty(a,"waiting",{enumerable:!0,get(){return 0<c.length}}),a.afterFlush=b=>{setTimeout(()=>a.waiting?void a.afterFlush(b):b())},a.flush=()=>{if(a.waiting){const a=c.slice();c.length=0;for(const b of a)b()}},a})}),R=b(function(a){(function(b,c){a.exports=c()})(P,function(){const a=new WeakMap,b=Object.prototype.hasOwnProperty,c=a=>"[object Object]"===Object.prototype.toString.call(a)||Array.isArray(a),d=()=>{};class e{constructor(a){this.target=a,this.subscribers=new Set}static get observeOptions(){return{deep:!0,compare(a,b){return JSON.stringify(a)!==JSON.stringify(b)}}}static is(b){return c(b)&&a.has(b)}static get(b){return a.get(b)}static observe(f,g={},h=d){function i(a){h(a),l.dispatch(a)}if(e.is(f))return f;const{deep:j,compare:k}=Object.assign({},e.observeOptions,g),l=new e(f);if(j)for(const a in f)if(b.call(f,a)){const b=f[a];c(b)&&(f[a]=e.observe(b,g,i))}const m=new Proxy(f,{defineProperty(a,d,f){const{value:h}=f,l=a[d],m=b.call(a,d);j&&c(h)&&(f.value=e.observe(h,g,i));const n=Reflect.defineProperty(a,d,f);if(n&&(!m||k(h,l,d,a))){const b={type:m?"set":"add",value:h,property:d,target:a};m&&(b.old=l),i(b)}return n},deleteProperty(a,c){const d=a[c],e=b.call(a,c)&&Reflect.deleteProperty(a,c);return e&&i({type:"delete",old:d,property:c,target:a}),e}});return a.set(f,l),a.set(m,l),m}subscribe(a){return this.subscribers.add(a),this}unsubscribe(a){return this.subscribers.delete(a),this}dispatch(a){return this.subscribers.forEach(b=>{b(a,this.target)}),this}}return e})}),S={_$f(a,b){return b.reduce((a,b)=>{const c=O.filters[b.name];return b.args?c(a,...b.args):c(a)},a)},_$n(a){return g(a)?a:""}};const T=/(?<!\|)\|(?!\|)/,U=/^(?<name>\w+)(?:\((?<args>.*)\))?$/,V=/{{(?<expression>.*?)}}/,W=/#(?<name>\w+)\(/g,X=new Map;class Y{constructor(a,b){this.node=a,this.renderer=b,this.getter=o(a.nodeValue)}static is({nodeValue:a}){return V.test(a)}render(){const a=this.getter(this.renderer.scope,this.renderer.isolated);this.node.nodeValue!==a&&(this.node.nodeValue=a)}}class Z{constructor(a,b,c){this.scope=b,this.element=a,this.isolated=c,this.locals=Object.create(null),this.isPlaceholder=i(a),this.directives=[],this._init(a)}get isRenderable(){return this.directives.length}_init(a){const b=Array.from(a.attributes);for(const c of b){const{name:b,value:d}=c;Y.is(c)&&this.directives.push(new Y(c,this));for(const c of O.directives){const e=c._match(b,a);if(e){const f={name:e.name,args:e.args?e.args.split("."):[],value:d};if(c.match(f,this)){const d=new c(f,this);d.init(),d.$options.$render&&this.directives.push(d),O.debug||a.removeAttribute(b);break}}}}}render(){for(const a of this.directives)a.render()}}var $=/[|\\{}()[\]^$+*?.]/g,_=function(a){if("string"!=typeof a)throw new TypeError("Expected a string");return a.replace($,"\\$&")};const aa=a=>a,ba=/-([a-z0-9])/gi,ca=/(?<=[a-z0-9])([A-Z])/g,da="<name>";class ea extends Z{constructor(a,b,c){super(a,b,A(c)),this.childrenRenderer=new ja((this.isPlaceholder?a.content:a).childNodes,b,this.isolated)}get isRenderable(){return super.isRenderable||0<this.childrenRenderer.renderers.length}get isFlattenable(){return 0<this.childrenRenderer.renderers.length&&!this.directives.length}render(){super.render(),(this.isPlaceholder||this.element.isConnected)&&this.childrenRenderer.render()}}class fa extends ea{constructor(a,b,c){super(a.cloneNode(!0),b.scope,A(b.isolated,c)),this.by=I(this.element),this.reused=!1}get children(){return this.childrenRenderer.children}get key(){return this.by()}get next(){return(this.isPlaceholder?this.children[this.children.length-1]:this.element).nextSibling}update(a){this.reused=!0,Object.assign(this.isolated,a)}insert(a){a.before(...(this.isPlaceholder?this.children:[this.element]))}remove(){this.isPlaceholder?this.children.forEach(a=>a.remove()):this.element.remove()}}const ga="*for",ha=/^\(?(?<value>\w+)(?:\s*,\s*(?<key>\w+)(?:\s*,\s*(?<index>\w+))?)?\)?\s+(?:in|of)\s+(?<expression>.+)$/;class ia{constructor(a,b){this.template=a,this.renderer=b,this.items=[],this.values=new Map;const c=y(a,ga),{groups:d}=c.match(ha);this.keyName=d.key,this.indexName=d.index,this.valueName=d.value,this.startAnchor=z(`start for: ${c}`),this.endAnchor=z(`end for: ${c}`),this.getter=p(d.expression),a.replaceWith(this.startAnchor),this.startAnchor.nextSibling.before(this.endAnchor),a.hasAttribute("by")||(O.debug&&console.warn("The element with the loop expression `"+c+"` doesn't have a `by` attribute, fallbacking to `$index` tracking."),a.setAttribute("by","$index"))}static is({attributes:a}){return ga in a}render(){const a=this.getter(this.renderer.scope,this.renderer.isolated),b=[],c=Object.keys(a);c.forEach((c,d)=>{let e=this.items[d];const f={$index:d,$key:c,[this.keyName]:c,[this.indexName]:d,[this.valueName]:a[c]};if(!e)e=new fa(this.template,this.renderer,f),e.insert(this.endAnchor),this.values.set(e.key,e);else{const a=e.by(f);if(e.key!==a){const b=this.values.get(a),c=b.next;b.insert(e.next),e.insert(c),this.items[this.items.indexOf(b)]=e,this.items[d]=b,e=b}e.update(f)}b.push(e),e.render()});for(const a of this.items)a.reused?a.reused=!1:(this.values.delete(a.key.value),a.remove());this.items=b}}class ja{constructor(a,b,c){this.children=Array.from(a),this.scope=b,this.isolated=c,this.renderers=[],this._init()}_init(){for(const a of this.children)if(d(a)&&Y.is(a))this.renderers.push(new Y(a,this));else if(e(a))if(ia.is(a))this.renderers.push(new ia(a,this));else{const b=new((i(a)?a.content:a).childNodes.length?ea:Z)(a,this.scope,this.isolated);b.isRenderable&&this.renderers.push(...(b.isFlattenable?C(b):[b]))}}render(){for(const a of this.renderers)a.render()}}var ka={$on(a,b,c){(this.$events[a]=E(this.$events,a)).push(b),this.addEventListener(a,b,c)},$once(a,b,c={}){"boolean"==typeof c&&(c={capture:c});const d=a=>{F(b),b.call(this,a)};c.once=!0,d.listener=b,this.$on(a,d,c)},$off(a,b){switch(arguments.length){case 0:for(a in this.$events)this.$off(a);break;case 1:for(const b of E(this.$events,a))this.$off(a,b);break;default:F(this.$events,a,b),this.removeEventListener(a,b);}},$emit(a,b){this.dispatchEvent(a instanceof Event?a:new CustomEvent(a,{detail:b}))}};class la extends Error{}const ma=new WeakMap,na={$plain:!1,$render:!0};class oa{static get is(){return x(this.name)}constructor(a,b){if(this.$name=a.name,this.$args=a.args,this.$value=a.value,this.$renderer=b,this.$scope=b.scope,this.$element=b.element,this.$options=Object.assign({},na,this.constructor.options),!this.$options.$plain){const c=p(a.value);this.$getter=a=>c(b.scope,A(b.isolated,a))}}static get is(){return""}static match(){return!0}init(){}render(){}}oa._matcher=null,oa._match=function(a){const b=this._matcher.exec(a);return b&&b.groups};class pa extends Event{constructor(a,b){super(a,b),this.$target=b.target,this.$stopped=!1,this.$performed=!1,this._transitionCb=b.transitionCb}stop(){this.$performed||(this.$stopped=!0)}play(){this.$performed||(this.$stopped=!1)}perform(){this.$stopped||this.$performed||(this.$stopped=!1,this.$performed=!0,this._transitionCb())}}class qa extends oa{static get is(){return"*if"}get isPlaceholder(){return this.$renderer.isPlaceholder}init(){if(this.anchor=z(`if: ${this.$value}`),this.render=this.isPlaceholder?this._firstRenderMultiple:this._renderSingle,this.isPlaceholder&&(this.children=Array.from(this.$element.content.childNodes),!this.children.length))throw new la("placeholder element with a conditional must have at least one child node")}_renderSingle(){const{isConnected:a}=this.$element;let b;this.$getter()?!a&&(b="enter"):a&&(b="leave",this.$element.replaceWith(this.anchor)),b&&this._dispatchTransitionEvent(b,this.$element,()=>{const a="leave"===b;this[a?"$element":"anchor"].replaceWith(this[a?"anchor":"$element"])})}_firstRenderMultiple(){this.$element.replaceWith(this.anchor),this.$getter()&&this._appendChildren(),this.render=this._renderMultiple}_renderMultiple(){if(this.$getter())this._appendChildren();else for(const a of this.children)a.isConnected&&this._dispatchTransitionEvent("leave",a,()=>a.remove())}_appendChildren(){let a=this.children.length;const{parentNode:b}=this.anchor;for(;a--;){const c=this.children[a];c.isConnected||this._dispatchTransitionEvent("enter",c,()=>{b.insertBefore(c,this.anchor.nextSibling)})}}_dispatchTransitionEvent(a,b,c){const d=new pa(`if:${a}`,{target:b,transitionCb:c});this.$element.dispatchEvent(d),d.perform()}}class ra extends oa{static get is(){return"@<name>"}static get options(){return{$plain:!0,$render:!1}}init(){const{$args:a,$scope:b,$name:c,$element:d,$renderer:e}=this,f=a.includes("once"),g=q(this.$value);let h;const i=[];let k="addEventListener";a.includes("self")&&i.push((a,b)=>{b.target===b.currentTarget&&a(b)}),a.includes("prevent")&&i.push((a,b)=>{b.preventDefault(),a(b)}),j(d)?k=`$on${f?"ce":""}`:f&&i.push((a,b)=>{d.removeEventListener(c,h),a(b)}),i.push((a,c)=>{g(b,A(e.isolated,{$event:c})),a()}),d[k](c,h=H(i))}}class sa extends oa{static get is(){return".<name>"}init(){this._inCustom=j(this.$element),this.$element[this.$name]=null}render(){this.$element[this.$name]=this.$getter(),this._inCustom&&this.$element.$render()}}class ta extends oa{static get is(){return"ref"}init(){this.refName=w(this.$value)}render(){const{$scope:a,$element:b,refName:c}=this;b.isConnected?a.$refs[c]=b:delete a.$refs[c]}}class ua extends oa{static get is(){return":<name>"}_getObserved(){let a=this.$element.getAttributeNode(this.$name);return O.debug||this.$element.removeAttribute(this.$name),a||(a=document.createAttribute(this.$name),this.$element.setAttributeNode(a)),a}init(){this.attribute=this._getObserved()}render(){const a=this.$getter();"boolean"==typeof a?this.element[`${a?"set":"remove"}AttributeNode`](this.attribute):B(this.attribute,a)&&(this.attribute.value=a)}}class va extends ua{static get is(){return":class"}_getNormalized(){const a=this.$getter();if(!Array.isArray(a))return a;return a.forEach(a=>{c(a)?Object.assign(result,a):result[a]=1}),{}}render(){const a=this._getNormalized();if(!c(a))return super.render();for(const b in a)a.hasOwnProperty(b)&&this.$element.classList[a[b]?"add":"remove"](b)}}class wa extends ua{static get is(){return":style"}static parseRule(a){const b=a.split(".");return{prop:b[0],unit:b[1]}}init(){this.styles={}}render(){const a=this.$getter();if(!c(a))return super.render();const b=this.$element.attributeStyleMap;for(const c in this.styles)a.hasOwnProperty(c)||b.delete(wa.parseRule(c).prop);for(const c in a){const d=a[c];if(this.styles[c]!==d){const{prop:a,unit:e}=wa.parseRule(c);b.set(a,e?CSS[e](d):d)}}this.styles=Object.assign({},a)}}class xa extends oa{static get is(){return"*bind"}init(){this.setting=!1;const a=s(this.$value);this.setter=b=>{a(this.$scope,this.$renderer.isolated,b)},this.onInput&&this.$element.addEventListener("input",this.onInput.bind(this)),this.onChange&&this.$element.addEventListener("change",this.onChange.bind(this))}static setMultiple(a,b,c){const d=c.indexOf(b);a?-1===d&&c.push(b):-1<d&&c.splice(d,1)}setValue(a){this.setting=!0,this.setter(a)}render(){this.setting?this.setting=!1:this.update(this.$element,this.$getter())}}class ya extends xa{static match(a,{element:b}){return"checkbox"===b.type}onChange({target:a}){const b=this.$getter();return Array.isArray(b)?void xa.setMultiple(a.checked,a.value,b):this.setValue(a.checked)}update(a,b){a.checked=!!b}}class za extends xa{static match(a,{element:b}){return"radio"===b.type}onChange({target:a}){a.checked&&this.setValue(a.value)}update(a,b){a.checked=b+""===a.value}}class Aa extends xa{static match(a,{element:b}){return b instanceof HTMLInputElement||b instanceof HTMLTextAreaElement}init(){switch(super.init(),this.valueKey="value",this.$args[0]){case"number":this.valueKey+="AsNumber";break;case"date":this.valueKey+="AsDate";}}onInput({target:a}){this.setValue(a[this.valueKey])}update(a,b){a[this.valueKey]!==b&&(a[this.valueKey]=b)}}class Ba extends xa{static match(a,{element:b}){return b instanceof HTMLSelectElement}onChange({target:a}){const{options:b,multiple:c}=a;if(!c){for(const{value:a,selected:c}of b)if(c)return this.setValue(a);}else{const a=this.$getter();if(!Array.isArray(a))throw new la("Invalid bound value. *bind directive on select elements with a `multiple` attribute must have an array bound value.");for(const c of b)xa.setMultiple(c.selected,c.value,a)}}update(a,b){for(const c of a.options)c.selected=a.multiple?-1<b.indexOf(c.value):b===c.value}}class Ca{static init(){}static install(){}static with(a){return Object.assign(this.$options,this.$defaults,a),this}}_defineProperty(Ca,"$options",{}),_defineProperty(Ca,"$defaults",{});const Da=K(HTMLElement);a.config=O,a.extend=K,a.GalaxyElement=Da,a.html=function(...a){return L("template",...a)},a.css=function(...a){const b=L("style",...a);return b.setAttribute("skip",""),b},a.setup=function(a){if(Object.assign(O,a),O.plugins)for(const a of O.plugins)a.init(O);O.directives.unshift(...[qa,ra,sa,ta,va,wa,ua,ya,za,Aa,Ba]);for(const b of O.directives)b._matcher=u(b.is);if(!O.root)throw new la("You must include a `root` option");M([O.root,...O.elements],O.plugins)},a.GalaxyDirective=oa,a.GalaxyPlugin=Ca,a.withCachedInstance=function(a){const b=a.init;return a.init=function(c){this.$instance=new a(this.$options),b.call(this,c)},a},Object.defineProperty(a,"__esModule",{value:!0})});