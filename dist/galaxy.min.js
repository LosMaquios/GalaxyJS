function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Galaxy={})})(this,function(e){"use strict";function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e,t){const i={};"function"==typeof t?i.expression=i.string=t:Object.assign(i,J,t);const s="string"==typeof e?new z(e):e,a=r(s);for(;!s.end;){switch(s.current){case V.DOLLAR_SIGN:s.is(V.OPEN_BRACE,1)&&s.inTemplate&&!s.escaping&&(s.mode=Q.EXPRESSION_MODE,a.templateStack.push(a.braceDepth++),s.advance(2));break;case V.OPEN_BRACE:s.inExpression&&a.braceDepth++;break;case V.CLOSE_BRACE:s.inExpression&&--a.braceDepth===a.templateStack[a.templateStack.length-1]&&(s.mode=Q.TEMPLATE_MODE,a.templateStack.pop(),s.advance());break;case V.BACKTICK:case V.SINGLE_QUOTE:case V.DOUBLE_QUOTE:s.inExpression?(s.mode=s.is(V.BACKTICK)?Q.TEMPLATE_MODE:Q.STRING_MODE,a.stringOpen=s.current,s.advance()):s.is(a.stringOpen)&&!s.escaping&&(s.mode=Q.EXPRESSION_MODE,a.stringOpen=null,s.advance());}if(s.end)break;let e;if(s.inExpression){if(Y.some(e=>s.is(e))){s.advance();continue}e=i.expression(s)}else(!s.is(V.BACKSLASH)||s.escaping)&&(e=i.string(s));if(e===n.STOP)break;s.escaping=s.mode!==Q.EXPRESSION_MODE&&s.is(V.BACKSLASH)&&!s.escaping,s.advance()}return s}function r(e){let t=q.get(e);return t||q.set(e,t={braceDepth:0,templateStack:[],stringOpen:null}),t}function i(e,t,n=te){const r=Math.max(0,t-n);let i=0,s=e.slice(r,t+n);return s=s.replace(ee,()=>(i++,"\\n")),s+"\n"+" ".repeat(i+t-r)+"^"}function s(e,t,n){return new ne(`\n\n${e.replace(/^[a-z]/,e=>e.toUpperCase())}:\n\n\t${i(t,n).replace(/\n/,"\n\t")}\n`,n)}function a(e,t){const r={},i=t.input,a=t.cursor;if(ie.test(t.current))throw s(`invalid ${e} start char name`,i,a);return n.expression(t,t=>{if(t.is(Z.START_ARGS)){let d=1;const l=t.advance().cursor,o=r.name=i.slice(a,l-1);if(!o.length)throw s(`${e} should have a name`,i,a);return n.expression(t,e=>{if(e.is(Z.START_ARGS))d++;else if(e.is(Z.END_ARGS)&&! --d)return r.args=i.slice(l,e.cursor),n.STOP}),n.STOP}if(!re.test(t.current))throw s(`invalid char in ${e} name`,i,t.cursor)}),r}function d(e,t){let r="",i=0;return n.expression(e,n=>{if(n.is(Z.STATEFUL_TOKEN)){const s=n.advance().cursor,{name:l,args:o}=a("stateful method",n);r+=e.slice(i,s-1)+`${t}('${l}'${o?`, ${d(o)}`:""})`,i=n.cursor+1}}),r+e.slice(i)}function l(e,t){let r=0;const i=[];return n.expression(e,t=>{t.is(Z.GT)&&t.is(Z.PIPE,-1)&&i.push({start:r,expression:e.slice(r,(r=t.cursor+1)-se)})}),i.push({start:r,expression:e.slice(r)}),i.slice(1).reduce((n,{start:r,expression:i})=>{const d=i.trim();if(!d)throw s("missing filter expression",e,r);let l,o;try{({name:l,args:o}=a("filter",new z(d)))}catch(t){throw s(t.message.split(":",1)[0].trimStart(),e,t.location+r+1)}return`${t}('${l||d}', ${n}${o?`, ${o}`:""})`},i[0].expression.trim())}function o(e,t,r){function i(e){e&&a.push(`\`${e}\``)}let a=[],d=0;return n.expression(e,o=>{if(o.is(Z.OPEN_TEMPLATE)&&o.is(Z.OPEN_TEMPLATE,-1)){let c=1;const p=o.advance().cursor;n.expression(o,o=>{if(o.is(Z.OPEN_TEMPLATE))c++;else if(o.is(Z.CLOSE_TEMPLATE)&&! --c){if(!o.is(Z.CLOSE_TEMPLATE,1))throw s("expecting closing template tag",e,o.cursor+1);i(e.slice(d,p-ae));const c=e.slice(p,o.cursor).trim();if(!c)throw s("missing template expression",e,o.cursor-1);try{a.push(`${t}(${l(c,r)})`)}catch(e){throw new ne(`\n\nError in template expression...\n${e.message.trimStart()}`,e.location)}return o.advance(2),d=o.cursor,n.STOP}})}}),i(e.slice(d)),a.join(" + ")}function c({message:e,stack:t}){const n=new ce(e);return n.stack=t,n}function p(e){return"number"==typeof e}function u(e){return"string"==typeof e}function m(e){return f(e)&&p(e.length)}function h(e){return e instanceof Set}function g(e){return e instanceof Map}function f(e){return null!==e&&"object"==typeof e}function E(e){return e.nodeType===Node.TEXT_NODE}function $(e){return e.nodeType===Node.ELEMENT_NODE}function v(e){return"function"==typeof e}function b(e){return null!=e}function _(e){return e.startsWith("$")||e.startsWith("_")}function y(e){return e instanceof HTMLTemplateElement}function x(e){return!!e.$galaxy}function T(e){e=Ee(e);const t=e.replace(ye,A("[:\\w-]+"));return new RegExp(`^${t===e?A(e):t}(?:.(?<args>.+))?$`)}function A(e){return`(?${"<name>"}${e})`}function S(e){return e.replace(be,(e,t)=>t.toUpperCase())}function O(e){return e.replace(_e,(e,t)=>`-${t.toLowerCase()}`).toLowerCase()}function N(e,t,n=ve){const r=n(e.getAttribute(t));return X.debug||e.removeAttribute(t),r}function P(e){return X.debug?new Comment(` ${e} `):new Text}function C(...e){return Object.assign(Object.create(null),...e)}function L(e,t){return e.nodeValue!==t}function R(e){const t=[];return e.childrenRenderer.renderers.forEach(e=>{t.push(...(e.isFlattenable?R(e):[e]))}),t}function I(e,t,n){e.$emit(`$${t}`,n),t=e[`on${t.charAt(0).toUpperCase()+t.slice(1)}`],v(t)&&ge.afterFlush(()=>{t.call(e,n)})}function M(e,t){return e[t]||[]}function D(e,t,n){const r=M(e,t).filter(e=>e!==n);r.length?e[t]=r:delete e[t]}function k(e,t){return Object.assign(e.prototype,...t)}function w(e){return(...t)=>{let n=0;const r=(...t)=>{const i=e[n++];i&&i(r,...t)};r(...t)}}function G(e,t,n,r){const i=new $e(t,{target:n,transitionCb:r});e.dispatchEvent(i),i.perform()}function B(e){let t;const{style:n,template:r}=e.constructor;try{t=e.attachShadow({mode:"open"})}catch(t){}if(n instanceof HTMLStyleElement){if(!t)throw new ce("style cannot be attached");t.appendChild(n.cloneNode(!0))}if(r instanceof HTMLTemplateElement){if(!t)throw new ce("template cannot be attached");t.appendChild(r.content.cloneNode(!0))}return new Ne(t?t.childNodes:[],e,{})}function K(e){class t extends e{get state(){return Ie.get(this)}set state(e){const t=()=>{this.$render()};Ie.set(this,H.observe(e,{patch:!0},t)),t()}static get is(){return O(this.name)}get $name(){return this.constructor.is}constructor(){super(),_defineProperty(this,"$refs",Object.create(null)),_defineProperty(this,"$events",Object.create(null)),_defineProperty(this,"$parent",null),_defineProperty(this,"$rendering",!1),this.state={},this.$compiler=new oe({scope:this}),this.$renderer=B(this),I(this,"created")}}return _defineProperty(t,"children",[]),t.extendsBuiltIn=e!==HTMLElement,t.resolved=!1,t.prototype.$galaxy=t.$galaxy=!0,k(t,[Pe,Ce,Le,Re]),t}function U(e,...t){const n=document.createElement(e);return n.innerHTML=String.raw(...t),n}function F(e,t){const n=[];for(const r of e){if(r.resolved)continue;const e={},i=r.is;if(!i)throw new ce("Unknown element tag name");if(r.extendsBuiltIn&&!(e.extends=r.extends))throw new ce("Extended customized built-in elements must have an `extends` property");try{n.push(customElements.whenDefined(i)),W(r,t),Promise.all(F(r.children,t)).then(()=>{customElements.define(i,r,e)}),r.resolved=!0}catch(t){throw c(t)}}return n}function W(e,t){for(const n of t)n.install(e)}var X={root:null,debug:!0,elements:[],directives:[],plugins:[],filters:{}},j="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,H=t(function(e){(function(t,n){e.exports=n()})(j,function(){const e=new WeakMap,t=Object.prototype.hasOwnProperty,n=e=>"[object Object]"===Object.prototype.toString.call(e)||Array.isArray(e),r=()=>{};class i{constructor(e){this.target=e,this.subscribers=new Set}static get observeOptions(){return{deep:!0,compare(e,t){return JSON.stringify(e)!==JSON.stringify(t)}}}static is(t){return n(t)&&e.has(t)}static get(t){return e.get(t)}static observe(s,a={},d=r){function l(e){d(e),p.dispatch(e)}if(i.is(s))return s;const{deep:o,compare:c}=Object.assign({},i.observeOptions,a),p=new i(s);if(o)for(const e in s)if(t.call(s,e)){const t=s[e];n(t)&&(s[e]=i.observe(t,a,l))}const u=new Proxy(s,{defineProperty(e,r,s){const{value:d}=s,p=e[r],u=t.call(e,r);o&&n(d)&&(s.value=i.observe(d,a,l));const m=Reflect.defineProperty(e,r,s);if(m&&(!u||c(d,p,r,e))){const t={type:u?"set":"add",value:d,property:r,target:e};u&&(t.old=p),l(t)}return m},deleteProperty(e,n){const r=e[n],i=t.call(e,n)&&Reflect.deleteProperty(e,n);return i&&l({type:"delete",old:r,property:n,target:e}),i}});return e.set(s,p),e.set(u,p),u}subscribe(e){return this.subscribers.add(e),this}unsubscribe(e){return this.subscribers.delete(e),this}dispatch(e){return this.subscribers.forEach(t=>{t(e,this.target)}),this}}return i})}),V={DOLLAR_SIGN:"$",OPEN_BRACE:"{",CLOSE_BRACE:"}",DOUBLE_QUOTE:"\"",SINGLE_QUOTE:"'",BACKTICK:"`",BACKSLASH:"\\",WHITESPACE:" ",TAB:"\t",LINE_FEED:"\n",CAR_RETURN:"\r"};const Q={EXPRESSION_MODE:0,TEMPLATE_MODE:1,STRING_MODE:2};class z{constructor(e){_defineProperty(this,"cursor",0),_defineProperty(this,"mode",Q.EXPRESSION_MODE),_defineProperty(this,"escaping",!1),this.input=e}get end(){return this.cursor>=this.input.length}get previous(){return this.get(this.cursor-1)}get current(){return this.get(this.cursor)}get next(){return this.get(this.cursor+1)}get inTemplate(){return this.mode===Q.TEMPLATE_MODE}get inString(){return this.mode===Q.STRING_MODE}get inExpression(){return this.mode===Q.EXPRESSION_MODE}is(e,t=0){return this.get(this.cursor+t)===e}get(e){return this.input[e]}back(e=1){return this.cursor-=e,this}advance(e=1){return this.cursor+=e,this}}const q=new WeakMap,Y=[V.LINE_FEED,V.CAR_RETURN,V.WHITESPACE,V.TAB],J={expression(){},string(){}};n.STOP=5709,n.expression=function(e,t){return n(e,{expression:t})},n.string=function(e,t){return n(e,{string:t})};var Z={GT:">",PIPE:"|",STATEFUL_TOKEN:"#",OPEN_TEMPLATE:"{",CLOSE_TEMPLATE:"}",START_ARGS:"(",END_ARGS:")"};const ee=/\r?\n/g,te=25;class ne extends Error{constructor(e,t=null){super(e),_defineProperty(this,"name","GalaxyCompilerError"),this.location=t}}const re=/[$\w]/,ie=/\$|\d/,se=2,ae=2,de={template:"__$n",filter:"$filter",method:"$commit"},le=(()=>{let e=0;return()=>Math.random().toString(16).slice(2)+e++})();class oe{constructor({scope:e,pragma:t}){this._id=le(),this._evaluators=new Map,this.scope=e,this.pragma=Object.assign({},de,t)}compileTemplate(e){return this.compileGetter(o(e,this.pragma.template,this.pragma.filter))}compileExpression(e){return this.compileGetter(l(e,this.pragma.filter))}compileEvent(e){return this.compileEvaluator(d(e,this.pragma.method))}compileSetter(e){return this.compileEvaluator(`(${e} = __args_${this._id}__[0])`)}compileGetter(e){return this.compileEvaluator(`return ${e}`)}compileEvaluator(e){let t=this._evaluators.get(e);return t||(t=new Function(`__locals_${this._id}__`,`...__args_${this._id}__`,"with (this) {with (state) {"+`with (__locals_${this._id}__) {`+e+"}}}"),this._evaluators.set(e,t)),(e={},...n)=>t.call(this.scope,e,...n)}}class ce extends Error{}const{isArray:pe}=Array,ue=/{{.*?}}/;class me{constructor(e,{scope:{$compiler:n},isolated:t}){this.text=e;const r=n.compileTemplate(e.data);this.getter=()=>r(t)}static is(e){return E(e)&&ue.test(e.data)}render(){const e=this.getter()+"";this.text.data!==e&&(this.text.data=e)}}class he{constructor(e,t,n){this.scope=t,this.element=e,this.isolated=n,this.locals=Object.create(null),this.isPlaceholder=y(e),this.directives=[],this._init(e)}get isRenderable(){return this.directives.length}_init(e){const t=Array.from(e.attributes);for(const n of t){const{name:t,value:r}=n;for(const n of X.directives){const i=n._match(t,e);if(i){const s={name:i.name,args:i.args?i.args.split("."):[],value:r};if(n.match(s,this)){const r=new n(s,this);r.init(),r.$options.$render&&this.directives.push(r),X.debug||e.removeAttribute(t);break}}}}}render(){for(const e of this.directives)e.render()}}var ge=t(function(e){(function(t,n){e.exports=n()})(j,function(){function e(r){e.waiting||t.then(e.flush),n.push(r)}const t=Promise.resolve(),n=e.queue=[];return Object.defineProperty(e,"waiting",{enumerable:!0,get(){return 0<n.length}}),e.afterFlush=t=>{setTimeout(()=>e.waiting?void e.afterFlush(t):t())},e.flush=()=>{if(e.waiting){const e=n.slice();n.length=0;for(const t of e)t()}},e})}),fe=/[|\\{}()[\]^$+*?.]/g,Ee=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(fe,"\\$&")};class $e extends Event{constructor(e,t){super(e,t),this.$target=t.target,this.$stopped=!1,this.$performed=!1,this._transitionCb=t.transitionCb}stop(){this.$performed||(this.$stopped=!0)}play(){this.$performed||(this.$stopped=!1)}perform(){this.$stopped||this.$performed||(this.$stopped=!1,this.$performed=!0,this._transitionCb())}}const ve=e=>e,be=/-([a-z0-9])/gi,_e=/(?<=[a-z0-9])([A-Z])/g,ye="<name>";class xe extends he{constructor(e,t,n){super(e,t,C(n)),this.childrenRenderer=new Ne((this.isPlaceholder?e.content:e).childNodes,t,this.isolated)}get isRenderable(){return super.isRenderable||0<this.childrenRenderer.renderers.length}get isFlattenable(){return 0<this.childrenRenderer.renderers.length&&!this.directives.length}render(){super.render(),(this.isPlaceholder||this.element.isConnected)&&this.childrenRenderer.render()}}class Te extends xe{constructor(e,t,n){super(e.cloneNode(!0),t.scope,C(t.isolated,n));const r=this.scope.$compiler.compileExpression(this.element.getAttribute("by"));this.by=e=>r(C(this.isolated,e)),this.updated=!1}get children(){return this.childrenRenderer.children}get key(){return this.by()}get next(){return(this.isPlaceholder?this.children[this.children.length-1]:this.element).nextSibling}update(e){Object.assign(this.isolated,e),this.updated=!0}insert(e,t){if(!this.isPlaceholder){const n=()=>e.before(this.element);return t?this._dispatchTransitionEvent(t,this.element,n):n()}const n=t=>e.before(t);this.children.forEach(e=>{t?this._dispatchTransitionEvent(t,this.element,()=>n(e)):n(e)})}remove(){return this.isPlaceholder?this.children.forEach(e=>{this._dispatchTransitionEvent("leave",this.element,()=>e.remove())}):void this._dispatchTransitionEvent("leave",this.element,()=>{this.element.remove()})}_dispatchTransitionEvent(e,t,n){G(this.element,`for:${e}`,t,n)}}const Ae="*for",Se=/^\(?(?<value>\w+)(?:\s*,\s*(?<key>\w+)(?:\s*,\s*(?<index>\w+))?)?\)?\s+(?:in|of)\s+(?<expression>.+)$/;class Oe{constructor(e,t){this.template=e,this.renderer=t,this.items=[];const n=N(e,Ae),{groups:r}=n.match(Se);this.keyName=r.key,this.indexName=r.index,this.valueName=r.value,this.startAnchor=P(`start for: ${n}`),this.endAnchor=P(`end for: ${n}`),this.getter=t.scope.$compiler.compileExpression(r.expression),e.replaceWith(this.startAnchor),this.startAnchor.nextSibling.before(this.endAnchor),e.hasAttribute("by")||(X.debug&&console.warn("The element with the loop expression `"+n+"` doesn't have a `by` attribute, fallbacking to `$index` tracking."),e.setAttribute("by","$index"))}static is({attributes:e}){return Ae in e}_renderItem(e,t,n){let r=this.items[n];const i={$index:n,$key:t,[this.keyName]:t,[this.indexName]:n,[this.valueName]:e};if(!r)r=new Te(this.template,this.renderer,i),r.insert(this.endAnchor,"enter");else{const e=r.by(i);if(r.key!==e){let t;const i=this.items.find((n,r)=>n.key===e&&(t=r)),s=i.next;i.insert(r.next,"move"),r.insert(s),this.items[t]=r,this.items[n]=i,r=i}r.update(i)}return r.render(),r}render(){const e=[],t=this.getter(this.renderer.isolated);if(p(t))for(let n=0;n<t;n++)e.push(this._renderItem(n+1,n,n));else if(pe(t)||m(t)||u(t)){const{length:n}=t;for(let r=0;r<n;r++)e.push(this._renderItem(t[r],r,r))}else if(h(t)||g(t)){let n=0;t.forEach((t,r)=>{e.push(this._renderItem(t,r,n++))})}else if(t[Symbol.iterator]){let n,r=0;for(const i=t[Symbol.iterator]();!(n=i.next()).done;)e.push(this._renderItem(n.value,null,r++))}else if(f(t))Object.keys(t).forEach((n,r)=>{e.push(this._renderItem(t[n],n,r))});else if(null!=t)throw new ce("Invalid iterable value in *for directive. Expecting value of type number, string, array(-like), object, iterable, Map or Set "+`got '${typeof t}'`);for(const e of this.items)e.updated?e.updated=!1:e.remove();this.items=e}}class Ne{constructor(e,t,n){this.children=Array.from(e),this.scope=t,this.isolated=n,this.renderers=[],this._init()}_init(){for(const e of this.children)if(me.is(e))this.renderers.push(new me(e,this));else if($(e))if(Oe.is(e))this.renderers.push(new Oe(e,this));else{const t=new((y(e)?e.content:e).childNodes.length?xe:he)(e,this.scope,this.isolated);t.isRenderable&&this.renderers.push(...(t.isFlattenable?R(t):[t]))}}render(){for(const e of this.renderers)e.render()}}var Pe={$filter(e,t,...n){const r=X.filters[e];if(!r)throw new ce(`Unknown filter '${e}'`);return r(t,...n)},$commit(e,...t){if(e in this){if(!v(this[e]))throw new ce(`Method '${e}' must be a function`);if(_(e))throw new ce(`Could no call reserved method '${e}'`);this[e](this.state,...t)}},$render(){this.$rendering||(this.$emit("$render:before"),this.$rendering=!0,ge(()=>{let t;try{this.$renderer.render()}catch(n){if(n instanceof ce||(n=c(n)),X.debug)throw n;t=n}this.$rendering=!1,t&&this.$emit("$render:error",t)}))}},Ce={$on(e,t,n){(this.$events[e]=M(this.$events,e)).push(t),this.addEventListener(e,t,n)},$once(e,t,n={}){"boolean"==typeof n&&(n={capture:n});const r=e=>{D(t),t.call(this,e)};n.once=!0,r.listener=t,this.$on(e,r,n)},$off(e,t){switch(arguments.length){case 0:for(e in this.$events)this.$off(e);break;case 1:for(const t of M(this.$events,e))this.$off(e,t);break;default:D(this.$events,e,t),this.removeEventListener(e,t);}},$emit(e,t){this.dispatchEvent(e instanceof Event?e:new CustomEvent(e,{detail:t}))}},Le={connectedCallback(){let e=this;do e=e[e instanceof ShadowRoot?"host":"parentNode"];while(e&&!x(e));this.$parent=e,I(this,"attached")},disconnectedCallback(){this.$parent=null,I(this,"detached")},attributeChangedCallback(e,t,n){I(this,"attribute",{name:e,old:t,value:n})}},Re={__$n(e){return b(e)?e:""}};const Ie=new WeakMap,Me={$plain:!1,$render:!0};class De{static get is(){return O(this.name)}constructor(e,t){if(this.$name=e.name,this.$args=e.args,this.$value=e.value,this.$renderer=t,this.$scope=t.scope,this.$compiler=this.$scope.$compiler,this.$element=t.element,this.$options=Object.assign({},Me,this.constructor.options),!this.$options.$plain){const n=this.$compiler.compileExpression(e.value);this.$getter=e=>n(C(t.isolated,e))}}static get is(){return""}static match(){return!0}init(){}render(){}}De._matcher=null,De._match=function(e){const t=this._matcher.exec(e);return t&&t.groups};class ke extends De{static get is(){return"*if"}get isPlaceholder(){return this.$renderer.isPlaceholder}init(){if(this.anchor=P(`if: ${this.$value}`),this.render=this.isPlaceholder?this._firstRenderMultiple:this._renderSingle,this.isPlaceholder&&(this.children=Array.from(this.$element.content.childNodes),!this.children.length))throw new ce("placeholder element with a conditional must have at least one child node")}_renderSingle(){const{isConnected:e}=this.$element;let t;this.$getter()?!e&&(t="enter"):e&&(t="leave"),t&&this._dispatchTransitionEvent(t,this.$element,()=>{const e="leave"===t;this[e?"$element":"anchor"].replaceWith(this[e?"anchor":"$element"])})}_firstRenderMultiple(){this.$element.replaceWith(this.anchor),this.$getter()&&this._appendChildren(),this.render=this._renderMultiple}_renderMultiple(){if(this.$getter())this._appendChildren();else for(const e of this.children)e.isConnected&&this._dispatchTransitionEvent("leave",e,()=>e.remove())}_appendChildren(){let e=this.children.length;const{parentNode:t}=this.anchor;for(;e--;){const n=this.children[e];n.isConnected||this._dispatchTransitionEvent("enter",n,()=>{t.insertBefore(n,this.anchor.nextSibling)})}}_dispatchTransitionEvent(e,t,n){G(this.$element,`if:${e}`,t,n)}}class we extends De{static get is(){return"@<name>"}static get options(){return{$plain:!0,$render:!1}}init(){const{$args:e,$name:t,$element:n,$renderer:r}=this,i=e.includes("once"),s=this.$compiler.compileEvent(this.$value);let a;const d=[];let l="addEventListener";e.includes("self")&&d.push((e,t)=>{t.target===t.currentTarget&&e(t)}),e.includes("prevent")&&d.push((e,t)=>{t.preventDefault(),e(t)}),x(n)?l=`$on${i?"ce":""}`:i&&d.push((e,r)=>{n.removeEventListener(t,a),e(r)}),d.push((e,t)=>{s(C(r.isolated,{$event:t})),e()}),n[l](t,a=w(d))}}class Ge extends De{static get is(){return".<name>"}init(){this._inCustom=x(this.$element),this.$element[this.$name]=null}render(){this.$element[this.$name]=this.$getter(),this._inCustom&&this.$element.$render()}}class Be extends De{static get is(){return"ref"}init(){this.refName=S(this.$value)}render(){const{$scope:e,$element:t,refName:n}=this;t.isConnected?e.$refs[n]=t:delete e.$refs[n]}}class Ke extends De{static get is(){return":<name>"}_getObserved(){let e=this.$element.getAttributeNode(this.$name);return X.debug||this.$element.removeAttribute(this.$name),e||(e=document.createAttribute(this.$name),this.$element.setAttributeNode(e)),e}init(){this.attribute=this._getObserved()}render(){const e=this.$getter();"boolean"==typeof e?this.element[`${e?"set":"remove"}AttributeNode`](this.attribute):L(this.attribute,e)&&(this.attribute.value=e)}}class Ue extends Ke{static get is(){return":class"}_getNormalized(){const e=this.$getter();if(!Array.isArray(e))return e;return e.forEach(e=>{f(e)?Object.assign(result,e):result[e]=1}),{}}render(){const e=this._getNormalized();if(!f(e))return super.render();for(const t in e)e.hasOwnProperty(t)&&this.$element.classList[e[t]?"add":"remove"](t)}}class Fe extends Ke{static get is(){return":style"}static parseRule(e){const t=e.split(".");return{prop:t[0],unit:t[1]}}init(){this.styles={}}render(){const e=this.$getter();if(!f(e))return super.render();const t=this.$element.attributeStyleMap;for(const n in this.styles)e.hasOwnProperty(n)||t.delete(Fe.parseRule(n).prop);for(const n in e){const r=e[n];if(this.styles[n]!==r){const{prop:e,unit:i}=Fe.parseRule(n);t[r?"set":"delete"](e,i?CSS[i](r):r)}}this.styles=Object.assign({},e)}}class We extends De{static get is(){return"*bind"}init(){this.setting=!1;const e=this.$compiler.compileSetter(this.$value);this.setter=t=>e(this.$renderer.isolated,t),this.onInput&&this.$element.addEventListener("input",this.onInput.bind(this)),this.onChange&&this.$element.addEventListener("change",this.onChange.bind(this))}static setMultiple(e,t,n){const r=n.indexOf(t);e?-1===r&&n.push(t):-1<r&&n.splice(r,1)}setValue(e){this.setting=!0,this.setter(e)}render(){this.setting?this.setting=!1:this.update(this.$element,this.$getter())}}class Xe extends We{static match(e,{element:t}){return"checkbox"===t.type}onChange({target:e}){const t=this.$getter();return Array.isArray(t)?void We.setMultiple(e.checked,e.value,t):this.setValue(e.checked)}update(e,t){e.checked=!!t}}class je extends We{static match(e,{element:t}){return"radio"===t.type}onChange({target:e}){e.checked&&this.setValue(e.value)}update(e,t){e.checked=t+""===e.value}}class He extends We{static match(e,{element:t}){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement}init(){switch(super.init(),this.valueKey="value",this.$args[0]){case"number":this.valueKey+="AsNumber";break;case"date":this.valueKey+="AsDate";}}onInput({target:e}){this.setValue(e[this.valueKey])}update(e,t){e[this.valueKey]!==t&&(e[this.valueKey]=t)}}class Ve extends We{static match(e,{element:t}){return t instanceof HTMLSelectElement}onChange({target:e}){const{options:t,multiple:n}=e;if(!n){for(const{value:e,selected:n}of t)if(n)return this.setValue(e);}else{const e=this.$getter();if(!Array.isArray(e))throw new ce("Invalid bound value. *bind directive on select elements with a `multiple` attribute must have an array bound value.");for(const n of t)We.setMultiple(n.selected,n.value,e)}}update(e,t){for(const n of e.options)n.selected=e.multiple?-1<t.indexOf(n.value):t===n.value}}class Qe{static init(){}static install(){}static with(e){return Object.assign(this.$options,this.$defaults,e),this}}_defineProperty(Qe,"$options",{}),_defineProperty(Qe,"$defaults",{});const ze=K(HTMLElement);e.config=X,e.extend=K,e.GalaxyElement=ze,e.html=function(...e){return U("template",...e)},e.css=function(...e){const t=U("style",...e);return t.setAttribute("skip",""),t},e.setup=function(e){if(Object.assign(X,e),X.plugins)for(const e of X.plugins)e.init(X);X.directives.unshift(...[ke,we,Ge,Be,Ue,Fe,Ke,Xe,je,He,Ve]);for(const t of X.directives)t._matcher=T(t.is);if(!X.root)throw new ce("You must include a `root` option");F([X.root,...X.elements],X.plugins)},e.GalaxyDirective=De,e.GalaxyPlugin=Qe,e.withCachedInstance=function(e){const t=e.init;return e.init=function(n){this.$instance=new e(this.$options),t.call(this,n)},e},Object.defineProperty(e,"__esModule",{value:!0})});