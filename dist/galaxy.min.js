function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Galaxy={})})(this,function(e){"use strict";function t(e,t,i,s){if(i.deep&&e.size){function n(e){return Z(e)?s(e,i,t):e}const r=Array.from(e);if(e.clear(),e.add)for(const t of r)e.add(n(t));else for(const[t,i]of r)e.set(n(t),n(i))}n(e,t,i,s),r(e,"clear",de(t))}function n(e,t,n,i){const s="add"in e;r(e,s?"add":"set",(s?ie:se)(t,e=>n.deep&&Z(e)?i(e,n,t):e)),r(e,"delete",ae(t))}function r(e,t,n){const r=e[t];Object.defineProperty(e,t,{value:n(r)})}function i(e,t){const n={};"function"==typeof t?n.expression=n.string=t:Object.assign(n,ge,t);const r="string"==typeof e?new ue(e):e,a=s(r);for(;!r.end;){switch(r.current){case ce.DOLLAR_SIGN:r.is(ce.OPEN_BRACE,1)&&r.inTemplate&&!r.escaping&&(r.mode=pe.EXPRESSION_MODE,a.templateStack.push(a.braceDepth++),r.advance(2));break;case ce.OPEN_BRACE:r.inExpression&&a.braceDepth++;break;case ce.CLOSE_BRACE:r.inExpression&&--a.braceDepth===a.templateStack[a.templateStack.length-1]&&(r.mode=pe.TEMPLATE_MODE,a.templateStack.pop(),r.advance());break;case ce.BACKTICK:case ce.SINGLE_QUOTE:case ce.DOUBLE_QUOTE:r.inExpression?(r.mode=r.is(ce.BACKTICK)?pe.TEMPLATE_MODE:pe.STRING_MODE,a.stringOpen=r.current,r.advance()):r.is(a.stringOpen)&&!r.escaping&&(r.mode=pe.EXPRESSION_MODE,a.stringOpen=null,r.advance());}if(r.end)break;let e;if(r.inExpression){if(he.some(e=>r.is(e))){r.advance();continue}e=n.expression(r)}else(!r.is(ce.BACKSLASH)||r.escaping)&&(e=n.string(r));if(e===i.STOP)break;r.escaping=r.mode!==pe.EXPRESSION_MODE&&r.is(ce.BACKSLASH)&&!r.escaping,r.advance()}return r}function s(e){let t=me.get(e);return t||me.set(e,t={braceDepth:0,templateStack:[],stringOpen:null}),t}function a(e,t,n=Ee){const r=Math.max(0,t-n);let i=0,s=e.slice(r,t+n);return s=s.replace($e,()=>(i++,"\\n")),s+"\n"+" ".repeat(i+t-r)+"^"}function d(e,t,n){return new ve(`\n\n${e.replace(/^[a-z]/,e=>e.toUpperCase())}:\n\n\t${a(t,n).replace(/\n/,"\n\t")}\n`,n)}function l(e,t){const n={},r=t.input,s=t.cursor;if(ye.test(t.current))throw d(`invalid ${e} start char name`,r,s);return i.expression(t,t=>{if(t.is(fe.START_ARGS)){let a=1;const l=t.advance().cursor,o=n.name=r.slice(s,l-1);if(!o.length)throw d(`${e} should have a name`,r,s);return i.expression(t,e=>{if(e.is(fe.START_ARGS))a++;else if(e.is(fe.END_ARGS)&&! --a)return n.args=r.slice(l,e.cursor),i.STOP}),i.STOP}if(!be.test(t.current))throw d(`invalid char in ${e} name`,r,t.cursor)}),n}function o(e,t){let n="",r=0;return i.expression(e,i=>{if(i.is(fe.STATEFUL_TOKEN)){const s=i.advance().cursor,{name:a,args:d}=l("stateful method",i);n+=e.slice(r,s-1)+`${t}('${a}'${d?`, ${o(d)}`:""})`,r=i.cursor+1}}),n+e.slice(r)}function c(e,t){let n=0;const r=[];return i.expression(e,t=>{t.is(fe.GT)&&t.is(fe.PIPE,-1)&&r.push({start:n,expression:e.slice(n,(n=t.cursor+1)-_e)})}),r.push({start:n,expression:e.slice(n)}),r.slice(1).reduce((n,{start:r,expression:i})=>{const s=i.trim();if(!s)throw d("missing filter expression",e,r);let a,o;try{({name:a,args:o}=l("filter",new ue(s)))}catch(t){throw d(t.message.split(":",1)[0].trimStart(),e,t.location+r+1)}return`${t}('${a||s}', ${n}${o?`, ${o}`:""})`},r[0].expression.trim())}function p(e,t,n){function r(e){e&&s.push(`\`${e}\``)}let s=[],a=0;return i.expression(e,l=>{if(l.is(fe.OPEN_TEMPLATE)&&l.is(fe.OPEN_TEMPLATE,-1)){let o=1;const p=l.advance().cursor;i.expression(l,l=>{if(l.is(fe.OPEN_TEMPLATE))o++;else if(l.is(fe.CLOSE_TEMPLATE)&&! --o){if(!l.is(fe.CLOSE_TEMPLATE,1))throw d("expecting closing template tag",e,l.cursor+1);r(e.slice(a,p-xe));const o=e.slice(p,l.cursor).trim();if(!o)throw d("missing template expression",e,l.cursor-1);try{s.push(`${t}(${c(o,n)})`)}catch(e){throw new ve(`\n\nError in template expression...\n${e.message.trimStart()}`,e.location)}return l.advance(2),a=l.cursor,i.STOP}})}}),r(e.slice(a)),s.join(" + ")}function u({message:e,stack:t}){const n=new Oe(e);return n.stack=t,n}function m(e){return"number"==typeof e}function h(e){return"string"==typeof e}function g(e){return E(e)&&m(e.length)}function f(e){return e instanceof Set}function $(e){return e instanceof Map}function E(e){return null!==e&&"object"==typeof e}function v(e){return e.nodeType===Node.TEXT_NODE}function b(e){return e.nodeType===Node.ELEMENT_NODE}function y(e){return"function"==typeof e}function _(e){return null!=e}function x(e){return e.startsWith("$")||e.startsWith("_")}function T(e){return e instanceof HTMLTemplateElement}function A(e){return!!e.$galaxy}function S(e){e=Re(e);const t=e.replace(Ge,O("[:\\w-]+"));return new RegExp(`^${t===e?O(e):t}(?:.(?<args>.+))?$`)}function O(e){return`(?${"<name>"}${e})`}function P(e){return e.replace(Ie,(e,t)=>t.toUpperCase())}function N(e){return _(e)?e:""}function C(e){return e.replace(we,(e,t)=>`-${t.toLowerCase()}`).toLowerCase()}function L(e,t,n=De){const r=n(e.getAttribute(t));return Y.debug||e.removeAttribute(t),r}function R(e){return Y.debug?new Comment(` ${e} `):new Text}function k(...e){return Object.assign(Object.create(null),...e)}function D(e,t){return e.nodeValue!==t}function M(e){const t=[];return e.childrenRenderer.renderers.forEach(e=>{t.push(...(e.isFlattenable?M(e):[e]))}),t}function I(e,t,n){e.$emit(`$${t}`,n),t=e[`on${t.charAt(0).toUpperCase()+t.slice(1)}`],y(t)&&Ce.afterFlush(()=>{t.call(e,n)})}function w(e,t){return e[t]||[]}function G(e,t,n){const r=w(e,t).filter(e=>e!==n);r.length?e[t]=r:delete e[t]}function B(e,t){return Object.assign(e.prototype,...t)}function K(e){return(...t)=>{let n=0;const r=(...t)=>{const i=e[n++];i&&i(r,...t)};r(...t)}}function U(e,t,n,r){const i=new ke(t,{target:n,transitionCb:r});e.dispatchEvent(i),i.perform()}function F(e,t){for(let n of t.constructor.$stateMixins){n=n.call(t);for(const t of Object.keys(n))t in e||X(e,n,t)}}function W(e,t){const{prototype:n}=e,r=e.$stateMixins=[];for(const i of t)for(const e of Object.keys(i))if(j(e)){const t=n[e],r=i[e];n[e]=function(){t.call(this),r.call(this)}}else if("state"===e){const t=i[e];if("function"!=typeof t)throw new Oe("mixin `state` property must be a function which should return a fresh state object");r.push(t)}else e in n||X(n,i,e)}function X(e,t,n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}function j(e){return Me.some(t=>t===e)}function H(e){let t;const{style:n,template:r}=e.constructor;try{t=e.attachShadow({mode:"open"})}catch(t){}if(n instanceof HTMLStyleElement){if(!t)throw new Oe("style cannot be attached");t.appendChild(n.cloneNode(!0))}if(r instanceof HTMLTemplateElement){if(!t)throw new Oe("template cannot be attached");t.appendChild(r.content.cloneNode(!0))}return new Ve(t?t.childNodes:[],e,{})}function V(e){class t extends e{get state(){return Ye.get(this)}set state(e){const t=()=>{this.$render()};F(e,this),Ye.set(this,oe.observe(e,{patch:!0},t)),t()}static get is(){return C(this.name)}get $name(){return this.constructor.is}constructor(){super(),_defineProperty(this,"$refs",Object.create(null)),_defineProperty(this,"$events",Object.create(null)),_defineProperty(this,"$parent",null),_defineProperty(this,"$rendering",!1),this.state={},this.$compiler=new Se({scope:this}),this.$renderer=H(this),I(this,"created")}}return _defineProperty(t,"children",[]),_defineProperty(t,"mixins",[]),t.extendsBuiltIn=e!==HTMLElement,t.resolved=!1,t.prototype.$galaxy=t.$galaxy=!0,B(t,[ze,Qe,qe]),t}function z(e,...t){const n=document.createElement(e);return n.innerHTML=String.raw(...t),n}async function Q(e,t){const n=[];for(const r of e){if(r.__resolved__)continue;const e={},i=r.is;if(!i)throw new Oe("Unknown element tag name");if(r.extendsBuiltIn&&!(e.extends=r.extends))throw new Oe("Extended customized built-in elements must have an `extends` property");q(r,t.plugins),W(r,[...t.mixins,...r.mixins]),r.__resolved__=!0,await Q(r.children,t);try{customElements.define(i,r,e),n.push(customElements.whenDefined(i))}catch(e){throw u(e)}}await Promise.all(n)}function q(e,t){for(const n of t)n.install(e)}var Y={root:null,debug:!0,elements:[],mixins:[],directives:[],plugins:[],filters:{}};const J=Object.prototype.hasOwnProperty,Z=e=>"object"==typeof e&&null!==e&&!(e instanceof Date),ee=e=>!e.get&&!e.set&&Z(e.value)&&(e.configurable||e.writable),te=e=>e instanceof Map||e instanceof Set,ne=e=>e instanceof WeakMap||e instanceof WeakSet,re=()=>{},ie=(e,t)=>n=>function(r){return this.has(r)||(n.call(this,t(r)),e({type:"add",value:r,target:this})),this},se=(e,t)=>n=>function(r,i){const s=this.has(r),a=s&&this.get(r);if(!s||a!==i){const d={type:s?"set":"add",key:r,value:i,target:this};s&&(d.old=a),n.call(this,t(r),t(i)),e(d)}return this},ae=e=>t=>function(n){const r=this.get(n),i=t.call(this,n);return i&&e({type:"delete",old:r,key:n,target:this}),i},de=e=>t=>function(){if(target.size){const n=new this.constructor(Array.from(this));t.call(this),e({type:"clear",old:n,target:this})}},le=new WeakMap;class oe{constructor(e){this.target=e,this.subscribers=new Set}static get observeOptions(){return{deep:!0,patch:!1}}static is(e){return Z(e)&&le.has(e)}static get(e){return le.get(e)}static observe(e,r={},i=re){function s(e){i(e),l.dispatch(e)}if(oe.is(e))return e;const{deep:a,patch:d}=r=Object.assign({},oe.observeOptions,r),l=new oe(e);if(le.set(e,l),d){const i=te(e);if(i||ne(e))return(i?t:n)(e,s,r,oe.observe),e}if(a){const t=Object.getOwnPropertyDescriptors(e);for(const n in t){const i=t[n];ee(i)&&(i.value=oe.observe(i.value,r,s),Object.defineProperty(e,n,i))}}const o=new Proxy(e,{defineProperty(e,t,n){const i=e[t],d=J.call(e,t),l=n.get?n.get():n.value;a&&ee(n)&&(n.value=oe.observe(l,r,s));const o=Reflect.defineProperty(e,t,n);if(o&&(!d||l!==i)){const n={type:d?"set":"add",value:l,key:t,target:e};d&&(n.old=i),s(n)}return o},deleteProperty(e,t){const n=e[t],r=J.call(e,t)&&Reflect.deleteProperty(e,t);return r&&s({type:"delete",old:n,key:t,target:e}),r}});return le.set(o,l),o}subscribe(e){return this.subscribers.add(e),this}unsubscribe(e){return this.subscribers.delete(e),this}dispatch(e){return this.subscribers.forEach(t=>{t(e,this.target)}),this}}var ce={DOLLAR_SIGN:"$",OPEN_BRACE:"{",CLOSE_BRACE:"}",DOUBLE_QUOTE:"\"",SINGLE_QUOTE:"'",BACKTICK:"`",BACKSLASH:"\\",WHITESPACE:" ",TAB:"\t",LINE_FEED:"\n",CAR_RETURN:"\r"};const pe={EXPRESSION_MODE:0,TEMPLATE_MODE:1,STRING_MODE:2};class ue{constructor(e){_defineProperty(this,"cursor",0),_defineProperty(this,"mode",pe.EXPRESSION_MODE),_defineProperty(this,"escaping",!1),this.input=e}get end(){return this.cursor>=this.input.length}get previous(){return this.get(this.cursor-1)}get current(){return this.get(this.cursor)}get next(){return this.get(this.cursor+1)}get inTemplate(){return this.mode===pe.TEMPLATE_MODE}get inString(){return this.mode===pe.STRING_MODE}get inExpression(){return this.mode===pe.EXPRESSION_MODE}is(e,t=0){return this.get(this.cursor+t)===e}get(e){return this.input[e]}back(e=1){return this.cursor-=e,this}advance(e=1){return this.cursor+=e,this}}const me=new WeakMap,he=[ce.LINE_FEED,ce.CAR_RETURN,ce.WHITESPACE,ce.TAB],ge={expression(){},string(){}};i.STOP=5709,i.expression=function(e,t){return i(e,{expression:t})},i.string=function(e,t){return i(e,{string:t})};var fe={GT:">",PIPE:"|",STATEFUL_TOKEN:"#",OPEN_TEMPLATE:"{",CLOSE_TEMPLATE:"}",START_ARGS:"(",END_ARGS:")"};const $e=/\r?\n/g,Ee=25;class ve extends Error{constructor(e,t=null){super(e),_defineProperty(this,"name","GalaxyCompilerError"),this.location=t}}const be=/[$\w]/,ye=/\$|\d/,_e=2,xe=2,Te={template:"__$n",filter:"$filter",method:"$commit"},Ae=(()=>{let e=0;return()=>Math.random().toString(16).slice(2)+e++})();class Se{constructor({scope:e,pragma:t}){this._id=Ae(),this._evaluators=new Map,this.scope=e,this.pragma=Object.assign({},Te,t)}compileTemplate(e){return this.compileGetter(p(e,this.pragma.template,this.pragma.filter))}compileExpression(e){return this.compileGetter(c(e,this.pragma.filter))}compileEvent(e){return this.compileEvaluator(o(e,this.pragma.method))}compileSetter(e){return this.compileEvaluator(`(${e} = __args_${this._id}__[0])`)}compileGetter(e){return this.compileEvaluator(`return ${e}`)}compileEvaluator(e){let t=this._evaluators.get(e);return t||(t=new Function(`__locals_${this._id}__`,`...__args_${this._id}__`,"with (this) {with (state) {"+`with (__locals_${this._id}__) {`+e+"}}}"),this._evaluators.set(e,t)),(e={},...n)=>t.call(this.scope,e,...n)}}class Oe extends Error{constructor(...e){super(...e),_defineProperty(this,"name","GalaxyError")}}const{isArray:Pe}=Array;var Ne="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,Ce=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){(function(t,n){e.exports=n()})(Ne,function(){function e(r){e.waiting||t.then(e.flush),n.push(r)}const t=Promise.resolve(),n=e.queue=[];return Object.defineProperty(e,"waiting",{enumerable:!0,get(){return 0<n.length}}),e.afterFlush=t=>{setTimeout(()=>e.waiting?void e.afterFlush(t):t())},e.flush=()=>{if(e.waiting){const e=n.slice();n.length=0;for(const t of e)t()}},e})}),Le=/[|\\{}()[\]^$+*?.]/g,Re=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(Le,"\\$&")};class ke extends Event{constructor(e,t){super(e,t),this.$target=t.target,this.$stopped=!1,this.$performed=!1,this._transitionCb=t.transitionCb}stop(){this.$performed||(this.$stopped=!0)}play(){this.$performed||(this.$stopped=!1)}perform(){this.$stopped||this.$performed||(this.$stopped=!1,this.$performed=!0,this._transitionCb())}}const De=e=>e,Me=["onCreated","onAttached","onDetached","onAttribute"],Ie=/-([a-z0-9])/gi,we=/(?<=[a-z0-9])([A-Z])/g,Ge="<name>",Be=/{{.*?}}/;class Ke{constructor(e,{scope:{$compiler:n},isolated:t}){this.text=e;const r=n.compileTemplate(e.data);t=k(t,{__$n:N}),this.getter=()=>r(t)}static is(e){return v(e)&&Be.test(e.data)}render(){const e=this.getter()+"";this.text.data!==e&&(this.text.data=e)}}class Ue{constructor(e,t,n){this.scope=t,this.element=e,this.isolated=n,this.locals=Object.create(null),this.isPlaceholder=T(e),this.directives=[],this._init(e)}get isRenderable(){return this.directives.length}_init(e){const t=Array.from(e.attributes);for(const n of t){const{name:t,value:r}=n;for(const n of Y.directives){const i=n._match(t,e);if(i){const s={name:i.name,args:i.args?i.args.split("."):[],value:r};if(n.match(s,this)){const r=new n(s,this);r.init(),r.$options.$render&&this.directives.push(r),Y.debug||e.removeAttribute(t);break}}}}}render(){for(const e of this.directives)e.render()}}class Fe extends Ue{constructor(e,t,n){super(e,t,k(n)),this.childrenRenderer=new Ve((this.isPlaceholder?e.content:e).childNodes,t,this.isolated)}get isRenderable(){return super.isRenderable||0<this.childrenRenderer.renderers.length}get isFlattenable(){return 0<this.childrenRenderer.renderers.length&&!this.directives.length}render(){super.render(),(this.isPlaceholder||this.element.isConnected)&&this.childrenRenderer.render()}}class We extends Fe{constructor(e,t,n){super(e.cloneNode(!0),t.scope,k(t.isolated,n));const r=this.scope.$compiler.compileExpression(this.element.getAttribute("by"));this.by=e=>r(k(this.isolated,e)),this.updated=!1}get children(){return this.childrenRenderer.children}get key(){return this.by()}get next(){return(this.isPlaceholder?this.children[this.children.length-1]:this.element).nextSibling}update(e){Object.assign(this.isolated,e),this.updated=!0}insert(e,t){if(!this.isPlaceholder){const n=()=>e.before(this.element);return t?this._dispatchTransitionEvent(t,this.element,n):n()}const n=t=>e.before(t);this.children.forEach(e=>{t?this._dispatchTransitionEvent(t,this.element,()=>n(e)):n(e)})}remove(){return this.isPlaceholder?this.children.forEach(e=>{this._dispatchTransitionEvent("leave",this.element,()=>e.remove())}):void this._dispatchTransitionEvent("leave",this.element,()=>{this.element.remove()})}_dispatchTransitionEvent(e,t,n){U(this.element,`for:${e}`,t,n)}}const Xe="*for",je=/^\(?(?<value>\w+)(?:\s*,\s*(?<key>\w+)(?:\s*,\s*(?<index>\w+))?)?\)?\s+(?:in|of)\s+(?<expression>.+)$/;class He{constructor(e,t){this.template=e,this.renderer=t,this.items=[];const n=L(e,Xe),{groups:r}=n.match(je);this.keyName=r.key,this.indexName=r.index,this.valueName=r.value,this.startAnchor=R(`start for: ${n}`),this.endAnchor=R(`end for: ${n}`),this.getter=t.scope.$compiler.compileExpression(r.expression),e.replaceWith(this.startAnchor),this.startAnchor.nextSibling.before(this.endAnchor),e.hasAttribute("by")||(Y.debug&&console.warn("The element with the loop expression `"+n+"` doesn't have a `by` attribute, fallbacking to `$index` tracking."),e.setAttribute("by","$index"))}static is({attributes:e}){return Xe in e}_renderItem(e,t,n){let r=this.items[n];const i={$index:n,$key:t,[this.keyName]:t,[this.indexName]:n,[this.valueName]:e};if(!r)r=new We(this.template,this.renderer,i),r.insert(this.endAnchor,"enter");else{const e=r.by(i);if(r.key!==e){let t;const i=this.items.find((n,r)=>n.key===e&&(t=r)),s=i.next;i.insert(r.next,"move"),r.insert(s),this.items[t]=r,this.items[n]=i,r=i}r.update(i)}return r.render(),r}render(){const e=[],t=this.getter(this.renderer.isolated);if(m(t))for(let n=0;n<t;n++)e.push(this._renderItem(n+1,n,n));else if(Pe(t)||g(t)||h(t)){const{length:n}=t;for(let r=0;r<n;r++)e.push(this._renderItem(t[r],r,r))}else if(f(t)||$(t)){let n=0;t.forEach((t,r)=>{e.push(this._renderItem(t,r,n++))})}else if(t[Symbol.iterator]){let n,r=0;for(const i=t[Symbol.iterator]();!(n=i.next()).done;)e.push(this._renderItem(n.value,null,r++))}else if(E(t))Object.keys(t).forEach((n,r)=>{e.push(this._renderItem(t[n],n,r))});else if(null!=t)throw new Oe("Invalid iterable value in *for directive. Expecting value of type number, string, array(-like), object, iterable, Map or Set "+`got '${typeof t}'`);for(const e of this.items)e.updated?e.updated=!1:e.remove();this.items=e}}class Ve{constructor(e,t,n){this.children=Array.from(e),this.scope=t,this.isolated=n,this.renderers=[],this._init()}_init(){for(const e of this.children)if(Ke.is(e))this.renderers.push(new Ke(e,this));else if(b(e))if(He.is(e))this.renderers.push(new He(e,this));else{const t=new((T(e)?e.content:e).childNodes.length?Fe:Ue)(e,this.scope,this.isolated);t.isRenderable&&this.renderers.push(...(t.isFlattenable?M(t):[t]))}}render(){for(const e of this.renderers)e.render()}}var ze={$filter(e,t,...n){const r=Y.filters[e];if(!r)throw new Oe(`Unknown filter '${e}'`);return r(t,...n)},$commit(e,...t){if(e in this){if(!y(this[e]))throw new Oe(`Method '${e}' must be a function`);if(x(e))throw new Oe(`Could no call reserved method '${e}'`);this[e](this.state,...t)}},$afterRender(e){if(Ce(()=>this.$rendering?this.$afterRender(e):void e.call(this)),!e)return new Promise(t=>{e=t})},$render(){this.$rendering||(this.$emit("$render:before"),this.$rendering=!0,Ce(()=>{let t;try{this.$renderer.render()}catch(n){if(n instanceof Oe||(n=u(n)),Y.debug)throw n;t=n}this.$rendering=!1,t&&this.$emit("$render:error",t)}))}},Qe={$on(e,t,n){(this.$events[e]=w(this.$events,e)).push(t),this.addEventListener(e,t,n)},$once(e,t,n={}){"boolean"==typeof n&&(n={capture:n});const r=e=>{G(t),t.call(this,e)};n.once=!0,r.listener=t,this.$on(e,r,n)},$off(e,t){switch(arguments.length){case 0:for(e in this.$events)this.$off(e);break;case 1:for(const t of w(this.$events,e))this.$off(e,t);break;default:G(this.$events,e,t),this.removeEventListener(e,t);}},$emit(e,t){this.dispatchEvent(e instanceof Event?e:new CustomEvent(e,{detail:t}))}},qe={onCreated(){},onAttached(){},connectedCallback(){let e=this;do e=e[e instanceof ShadowRoot?"host":"parentNode"];while(e&&!A(e));this.$parent=e,I(this,"attached")},onDetached(){},disconnectedCallback(){this.$parent=null,I(this,"detached")},onAttribute(){},attributeChangedCallback(e,t,n){I(this,"attribute",{name:e,old:t,value:n})}};const Ye=new WeakMap,Je={$plain:!1,$render:!0};class Ze{static get is(){return C(this.name)}constructor(e,t){if(this.$name=e.name,this.$args=e.args,this.$value=e.value,this.$renderer=t,this.$scope=t.scope,this.$compiler=this.$scope.$compiler,this.$element=t.element,this.$options=Object.assign({},Je,this.constructor.options),!this.$options.$plain){const n=this.$compiler.compileExpression(e.value);this.$getter=e=>n(k(t.isolated,e))}}static get is(){return""}static match(){return!0}init(){}render(){}}Ze._matcher=null,Ze._match=function(e){const t=this._matcher.exec(e);return t&&t.groups};class et extends Ze{static get is(){return"*if"}get isPlaceholder(){return this.$renderer.isPlaceholder}init(){if(this.anchor=R(`if: ${this.$value}`),this.render=this.isPlaceholder?this._firstRenderMultiple:this._renderSingle,this.isPlaceholder&&(this.children=Array.from(this.$element.content.childNodes),!this.children.length))throw new Oe("placeholder element with a conditional must have at least one child node")}_renderSingle(){const{isConnected:e}=this.$element;let t;this.$getter()?!e&&(t="enter"):e&&(t="leave"),t&&this._dispatchTransitionEvent(t,this.$element,()=>{const e="leave"===t;this[e?"$element":"anchor"].replaceWith(this[e?"anchor":"$element"])})}_firstRenderMultiple(){this.$element.replaceWith(this.anchor),this.$getter()&&this._appendChildren(),this.render=this._renderMultiple}_renderMultiple(){if(this.$getter())this._appendChildren();else for(const e of this.children)e.isConnected&&this._dispatchTransitionEvent("leave",e,()=>e.remove())}_appendChildren(){let e=this.children.length;const{parentNode:t}=this.anchor;for(;e--;){const n=this.children[e];n.isConnected||this._dispatchTransitionEvent("enter",n,()=>{t.insertBefore(n,this.anchor.nextSibling)})}}_dispatchTransitionEvent(e,t,n){U(this.$element,`if:${e}`,t,n)}}class tt extends Ze{static get is(){return"*show"}init(){this.$style=this.$element.attributeStyleMap,this.initialDisplay=this.$style.get("display")}render(){this.$getter()?this._dispatchTransitionEvent("show",()=>{this.$style[this.initialDisplay?"set":"delete"]("display",this.initialDisplay)}):this._dispatchTransitionEvent("hide",()=>{this.$style.set("display","none")})}_dispatchTransitionEvent(e,t){U(this.$element,`show:${e}`,this.$element,t)}}class nt extends Ze{static get is(){return"@<name>"}static get options(){return{$plain:!0,$render:!1}}init(){const{$args:e,$name:t,$element:n,$renderer:r}=this,i=e.includes("once"),s=this.$compiler.compileEvent(this.$value);let a;const d=[];let l="addEventListener";e.includes("self")&&d.push((e,t)=>{t.target===t.currentTarget&&e(t)}),e.includes("prevent")&&d.push((e,t)=>{t.preventDefault(),e(t)}),A(n)?l=`$on${i?"ce":""}`:i&&d.push((e,r)=>{n.removeEventListener(t,a),e(r)}),d.push((e,t)=>{s(k(r.isolated,{$event:t})),e()}),n[l](t,a=K(d))}}class rt extends Ze{static get is(){return".<name>"}init(){this._inCustom=A(this.$element),this.$element[this.$name]=null}render(){this.$element[this.$name]=this.$getter(),this._inCustom&&this.$element.$render()}}class it extends Ze{static get is(){return"ref"}init(){this.refName=P(this.$value)}render(){const{$scope:e,$element:t,refName:n}=this;t.isConnected?e.$refs[n]=t:delete e.$refs[n]}}class st extends Ze{static get is(){return":<name>"}_getObserved(){let e=this.$element.getAttributeNode(this.$name);return Y.debug||this.$element.removeAttribute(this.$name),e||(e=document.createAttribute(this.$name),this.$element.setAttributeNode(e)),e}init(){this.attribute=this._getObserved()}render(){const e=this.$getter();"boolean"==typeof e?this.element[`${e?"set":"remove"}AttributeNode`](this.attribute):D(this.attribute,e)&&(this.attribute.value=e)}}class at extends st{static get is(){return":class"}_getNormalized(){const e=this.$getter();if(!Array.isArray(e))return e;return e.forEach(e=>{E(e)?Object.assign(result,e):result[e]=1}),{}}render(){const e=this._getNormalized();if(!E(e))return super.render();for(const t in e)e.hasOwnProperty(t)&&this.$element.classList[e[t]?"add":"remove"](t)}}class dt extends st{static get is(){return":style"}static parseRule(e){const t=e.split(".");return{prop:t[0],unit:t[1]}}init(){this.styles={}}render(){const e=this.$getter();if(!E(e))return super.render();const t=this.$element.attributeStyleMap;for(const n in this.styles)e.hasOwnProperty(n)||t.delete(dt.parseRule(n).prop);for(const n in e){const r=e[n];if(this.styles[n]!==r){const{prop:e,unit:i}=dt.parseRule(n);t[r?"set":"delete"](e,i?CSS[i](r):r)}}this.styles=Object.assign({},e)}}class lt extends Ze{static get is(){return"*bind"}init(){this.setting=!1;const e=this.$compiler.compileSetter(this.$value);this.setter=t=>e(this.$renderer.isolated,t),this.onInput&&this.$element.addEventListener("input",this.onInput.bind(this)),this.onChange&&this.$element.addEventListener("change",this.onChange.bind(this))}static setMultiple(e,t,n){const r=n.indexOf(t);e?-1===r&&n.push(t):-1<r&&n.splice(r,1)}setValue(e){this.setting=!0,this.setter(e)}render(){this.setting?this.setting=!1:this.update(this.$element,this.$getter())}}class ot extends lt{static match(e,{element:t}){return"checkbox"===t.type}onChange({target:e}){const t=this.$getter();return Array.isArray(t)?void lt.setMultiple(e.checked,e.value,t):this.setValue(e.checked)}update(e,t){e.checked=!!t}}class ct extends lt{static match(e,{element:t}){return"radio"===t.type}onChange({target:e}){e.checked&&this.setValue(e.value)}update(e,t){e.checked=t+""===e.value}}class pt extends lt{static match(e,{element:t}){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement}init(){switch(super.init(),this.valueKey="value",this.$args[0]){case"number":this.valueKey+="AsNumber";break;case"date":this.valueKey+="AsDate";}}onInput({target:e}){this.setValue(e[this.valueKey])}update(e,t){e[this.valueKey]!==t&&(e[this.valueKey]=t)}}class ut extends lt{static match(e,{element:t}){return t instanceof HTMLSelectElement}onChange({target:e}){const{options:t,multiple:n}=e;if(!n){for(const{value:e,selected:n}of t)if(n)return this.setValue(e);}else{const e=this.$getter();if(!Array.isArray(e))throw new Oe("Invalid bound value. *bind directive on select elements with a `multiple` attribute must have an array bound value.");for(const n of t)lt.setMultiple(n.selected,n.value,e)}}update(e,t){for(const n of e.options)n.selected=e.multiple?-1<t.indexOf(n.value):t===n.value}}class mt{static init(){}static install(){}static with(e){return Object.assign(this.$options,this.$defaults,e),this}}_defineProperty(mt,"$options",{}),_defineProperty(mt,"$defaults",{});const ht=V(HTMLElement);e.config=Y,e.extend=V,e.GalaxyElement=ht,e.html=function(...e){return z("template",...e)},e.css=function(...e){const t=z("style",...e);return t.setAttribute("skip",""),t},e.setup=function(e){if(Object.assign(Y,e),Y.plugins)for(const e of Y.plugins)e.init(Y);Y.directives.unshift(...[et,tt,nt,rt,it,at,dt,st,ot,ct,pt,ut]);for(const t of Y.directives)t._matcher=S(t.is);if(!Y.root)throw new Oe("You must include a `root` option");Q([Y.root,...Y.elements],Y)},e.GalaxyDirective=Ze,e.GalaxyPlugin=mt,e.withCachedInstance=function(e){const t=e.init;return e.init=function(n){this.$instance=new e(this.$options),t.call(this,n)},e},Object.defineProperty(e,"__esModule",{value:!0})});