function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Galaxy={})})(this,function(e){"use strict";function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e,t){const i={};"function"==typeof t?i.expression=i.string=t:Object.assign(i,j,t);const s="string"==typeof e?new W(e):e,a=r(s);for(;!s.end;){switch(s.current){case F.DOLLAR_SIGN:s.is(F.OPEN_BRACE,1)&&s.inTemplate&&!s.escaping&&(s.mode=V.EXPRESSION_MODE,a.templateStack.push(a.braceDepth++),s.advance(2));break;case F.OPEN_BRACE:s.inExpression&&a.braceDepth++;break;case F.CLOSE_BRACE:s.inExpression&&--a.braceDepth===a.templateStack[a.templateStack.length-1]&&(s.mode=V.TEMPLATE_MODE,a.templateStack.pop(),s.advance());break;case F.BACKTICK:case F.SINGLE_QUOTE:case F.DOUBLE_QUOTE:s.inExpression?(s.mode=s.is(F.BACKTICK)?V.TEMPLATE_MODE:V.STRING_MODE,a.stringOpen=s.current,s.advance()):s.is(a.stringOpen)&&!s.escaping&&(s.mode=V.EXPRESSION_MODE,a.stringOpen=null,s.advance());}if(s.end)break;let e;if(s.inExpression){if(H.some(e=>s.is(e))){s.advance();continue}e=i.expression(s)}else(!s.is(F.BACKSLASH)||s.escaping)&&(e=i.string(s));if(e===n.STOP)break;s.escaping=s.mode!==V.EXPRESSION_MODE&&s.is(F.BACKSLASH)&&!s.escaping,s.advance()}return s}function r(e){let t=X.get(e);return t||X.set(e,t={braceDepth:0,templateStack:[],stringOpen:null}),t}function i(e,t,n=q){const r=Math.max(0,t-n);let i=0,s=e.slice(r,t+n);return s=s.replace(z,()=>(i++,"\\n")),s+"\n"+" ".repeat(i+t-r)+"^"}function s(e,t,n){return new Y(`\n\n${e.replace(/^[a-z]/,e=>e.toUpperCase())}:\n\n\t${i(t,n).replace(/\n/,"\n\t")}\n`,n)}function a(e,t){const r={},i=t.input,a=t.cursor;if(Z.test(t.current))throw s(`invalid ${e} start char name`,i,a);return n.expression(t,t=>{if(t.is(Q.START_ARGS)){let d=1;const l=t.advance().cursor,o=r.name=i.slice(a,l-1);if(!o.length)throw s(`${e} should have a name`,i,a);return n.expression(t,e=>{if(e.is(Q.START_ARGS))d++;else if(e.is(Q.END_ARGS)&&! --d)return r.args=i.slice(l,e.cursor),n.STOP}),n.STOP}if(!J.test(t.current))throw s(`invalid char in ${e} name`,i,t.cursor)}),r}function d(e,t){let r="",i=0;return n.expression(e,n=>{if(n.is(Q.STATEFUL_TOKEN)){const s=n.advance().cursor,{name:l,args:o}=a("stateful method",n);r+=e.slice(i,s-1)+`${t}('${l}'${o?`, ${d(o)}`:""})`,i=n.cursor+1}}),r+e.slice(i)}function l(e,t){let r=0;const i=[];return n.expression(e,t=>{t.is(Q.GT)&&t.is(Q.PIPE,-1)&&i.push({start:r,expression:e.slice(r,(r=t.cursor+1)-ee)})}),i.push({start:r,expression:e.slice(r)}),i.slice(1).reduce((n,{start:r,expression:i})=>{const d=i.trim();if(!d)throw s("missing filter expression",e,r);let l,o;try{({name:l,args:o}=a("filter",new W(d)))}catch(t){throw s(t.message.split(":",1)[0].trimStart(),e,t.location+r+1)}return`${t}('${l||d}', ${n}${o?`, ${o}`:""})`},i[0].expression.trim())}function o(e,t,r){function i(e){e&&a.push(`\`${e}\``)}let a=[],d=0;return n.expression(e,o=>{if(o.is(Q.OPEN_TEMPLATE)&&o.is(Q.OPEN_TEMPLATE,-1)){let c=1;const p=o.advance().cursor;n.expression(o,o=>{if(o.is(Q.OPEN_TEMPLATE))c++;else if(o.is(Q.CLOSE_TEMPLATE)&&! --c){if(!o.is(Q.CLOSE_TEMPLATE,1))throw s("expecting closing template tag",e,o.cursor+1);i(e.slice(d,p-te));const c=e.slice(p,o.cursor).trim();if(!c)throw s("missing template expression",e,o.cursor-1);try{a.push(`${t}(${l(c,r)})`)}catch(e){throw new Y(`\n\nError in template expression...\n${e.message.trimStart()}`,e.location)}return o.advance(2),d=o.cursor,n.STOP}})}}),i(e.slice(d)),a.join(" + ")}function c({message:e,stack:t}){const n=new se(e);return n.stack=t,n}function p(e){return null!==e&&"object"==typeof e}function u(e){return e.nodeType===Node.TEXT_NODE}function m(e){return e.nodeType===Node.ELEMENT_NODE}function h(e){return"function"==typeof e}function g(e){return null!=e}function E(e){return e.startsWith("$")||e.startsWith("_")}function $(e){return e instanceof HTMLTemplateElement}function f(e){return!!e.$galaxy}function v(e){e=pe(e);const t=e.replace(Ee,b("[:\\w-]+"));return new RegExp(`^${t===e?b(e):t}(?:.(?<args>.+))?$`)}function b(e){return`(?${"<name>"}${e})`}function _(e){return e.replace(he,(e,t)=>t.toUpperCase())}function T(e){return e.replace(ge,(e,t)=>`-${t.toLowerCase()}`).toLowerCase()}function y(e,t,n=me){const r=n(e.getAttribute(t));return B.debug||e.removeAttribute(t),r}function x(e){return B.debug?new Comment(` ${e} `):new Text}function A(...e){return Object.assign(Object.create(null),...e)}function S(e,t){return e.nodeValue!==t}function O(e){const t=[];return e.childrenRenderer.renderers.forEach(e=>{t.push(...(e.isFlattenable?O(e):[e]))}),t}function N(e,t,n){e.$emit(`$${t}`,n),t=e[`on${t.charAt(0).toUpperCase()+t.slice(1)}`],h(t)&&oe.afterFlush(()=>{t.call(e,n)})}function P(e,t){return e[t]||[]}function C(e,t,n){const r=P(e,t).filter(e=>e!==n);r.length?e[t]=r:delete e[t]}function L(e,t){return Object.assign(e.prototype,...t)}function R(e){return(...t)=>{let n=0;const r=(...t)=>{const i=e[n++];i&&i(r,...t)};r(...t)}}function M(e,t,n,r){const i=new ue(t,{target:n,transitionCb:r});e.dispatchEvent(i),i.perform()}function D(e){let t;const{style:n,template:r}=e.constructor;try{t=e.attachShadow({mode:"open"})}catch(t){}if(n instanceof HTMLStyleElement){if(!t)throw new se("style cannot be attached");t.appendChild(n.cloneNode(!0))}if(r instanceof HTMLTemplateElement){if(!t)throw new se("template cannot be attached");t.appendChild(r.content.cloneNode(!0))}return new Te(t?t.childNodes:[],e,{})}function k(e){class t extends e{get state(){return Oe.get(this)}set state(e){const t=()=>{this.$render()};Oe.set(this,U.observe(e,null,t)),t()}static get is(){return T(this.name)}get $name(){return this.constructor.is}constructor(){super(),_defineProperty(this,"$refs",Object.create(null)),_defineProperty(this,"$events",Object.create(null)),_defineProperty(this,"$parent",null),_defineProperty(this,"$rendering",!1),this.state={},this.$compiler=new ie({scope:this}),this.$renderer=D(this),N(this,"created")}}return _defineProperty(t,"children",[]),t.extendsBuiltIn=e!==HTMLElement,t.resolved=!1,t.prototype.$galaxy=t.$galaxy=!0,L(t,[ye,xe,Ae,Se]),t}function I(e,...t){const n=document.createElement(e);return n.innerHTML=String.raw(...t),n}function w(e,t){const n=[];for(const r of e){if(r.resolved)continue;const e={},i=r.is;if(!i)throw new se("Unknown element tag name");if(r.extendsBuiltIn&&!(e.extends=r.extends))throw new se("Extended customized built-in elements must have an `extends` property");try{n.push(customElements.whenDefined(i)),G(r,t),Promise.all(w(r.children,t)).then(()=>{customElements.define(i,r,e)}),r.resolved=!0}catch(t){throw c(t)}}return n}function G(e,t){for(const n of t)n.install(e)}var B={root:null,debug:!0,elements:[],directives:[],plugins:[],filters:{}},K="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,U=t(function(e){(function(t,n){e.exports=n()})(K,function(){const e=new WeakMap,t=Object.prototype.hasOwnProperty,n=e=>"[object Object]"===Object.prototype.toString.call(e)||Array.isArray(e),r=()=>{};class i{constructor(e){this.target=e,this.subscribers=new Set}static get observeOptions(){return{deep:!0,compare(e,t){return JSON.stringify(e)!==JSON.stringify(t)}}}static is(t){return n(t)&&e.has(t)}static get(t){return e.get(t)}static observe(s,a={},d=r){function l(e){d(e),p.dispatch(e)}if(i.is(s))return s;const{deep:o,compare:c}=Object.assign({},i.observeOptions,a),p=new i(s);if(o)for(const e in s)if(t.call(s,e)){const t=s[e];n(t)&&(s[e]=i.observe(t,a,l))}const u=new Proxy(s,{defineProperty(e,r,s){const{value:d}=s,p=e[r],u=t.call(e,r);o&&n(d)&&(s.value=i.observe(d,a,l));const m=Reflect.defineProperty(e,r,s);if(m&&(!u||c(d,p,r,e))){const t={type:u?"set":"add",value:d,property:r,target:e};u&&(t.old=p),l(t)}return m},deleteProperty(e,n){const r=e[n],i=t.call(e,n)&&Reflect.deleteProperty(e,n);return i&&l({type:"delete",old:r,property:n,target:e}),i}});return e.set(s,p),e.set(u,p),u}subscribe(e){return this.subscribers.add(e),this}unsubscribe(e){return this.subscribers.delete(e),this}dispatch(e){return this.subscribers.forEach(t=>{t(e,this.target)}),this}}return i})}),F={DOLLAR_SIGN:"$",OPEN_BRACE:"{",CLOSE_BRACE:"}",DOUBLE_QUOTE:"\"",SINGLE_QUOTE:"'",BACKTICK:"`",BACKSLASH:"\\",WHITESPACE:" ",TAB:"\t",LINE_FEED:"\n",CAR_RETURN:"\r"};const V={EXPRESSION_MODE:0,TEMPLATE_MODE:1,STRING_MODE:2};class W{constructor(e){_defineProperty(this,"cursor",0),_defineProperty(this,"mode",V.EXPRESSION_MODE),_defineProperty(this,"escaping",!1),this.input=e}get end(){return this.cursor>=this.input.length}get previous(){return this.get(this.cursor-1)}get current(){return this.get(this.cursor)}get next(){return this.get(this.cursor+1)}get inTemplate(){return this.mode===V.TEMPLATE_MODE}get inString(){return this.mode===V.STRING_MODE}get inExpression(){return this.mode===V.EXPRESSION_MODE}is(e,t=0){return this.get(this.cursor+t)===e}get(e){return this.input[e]}back(e=1){return this.cursor-=e,this}advance(e=1){return this.cursor+=e,this}}const X=new WeakMap,H=[F.LINE_FEED,F.CAR_RETURN,F.WHITESPACE,F.TAB],j={expression(){},string(){}};n.STOP=5709,n.expression=function(e,t){return n(e,{expression:t})},n.string=function(e,t){return n(e,{string:t})};var Q={GT:">",PIPE:"|",STATEFUL_TOKEN:"#",OPEN_TEMPLATE:"{",CLOSE_TEMPLATE:"}",START_ARGS:"(",END_ARGS:")"};const z=/\r?\n/g,q=25;class Y extends Error{constructor(e,t=null){super(e),_defineProperty(this,"name","GalaxyCompilerError"),this.location=t}}const J=/[$\w]/,Z=/\$|\d/,ee=2,te=2,ne={template:"__$n",filter:"$filter",method:"$commit"},re=(()=>{let e=0;return()=>Math.random().toString(16).slice(2)+e++})();class ie{constructor({scope:e,pragma:t}){this._id=re(),this._evaluators=new Map,this.scope=e,this.pragma=Object.assign({},ne,t)}compileTemplate(e){return this.compileGetter(o(e,this.pragma.template,this.pragma.filter))}compileExpression(e){return this.compileGetter(l(e,this.pragma.filter))}compileEvent(e){return this.compileEvaluator(d(e,this.pragma.method))}compileSetter(e){return this.compileEvaluator(`(${e} = __args_${this._id}__[0])`)}compileGetter(e){return this.compileEvaluator(`return ${e}`)}compileEvaluator(e){let t=this._evaluators.get(e);return t||(t=new Function(`__locals_${this._id}__`,`...__args_${this._id}__`,"with (this) {with (state) {"+`with (__locals_${this._id}__) {`+e+"}}}"),this._evaluators.set(e,t)),(e={},...n)=>t.call(this.scope,e,...n)}}class se extends Error{}const ae=/{{.*?}}/;class de{constructor(e,{scope:t,isolated:n}){this.node=e;const r=t.$compiler.compileTemplate(e.nodeValue);this.getter=()=>r(n)}static is({nodeValue:e}){return ae.test(e)}render(){const e=this.getter();this.node.nodeValue!==e&&(this.node.nodeValue=e)}}class le{constructor(e,t,n){this.scope=t,this.element=e,this.isolated=n,this.locals=Object.create(null),this.isPlaceholder=$(e),this.directives=[],this._init(e)}get isRenderable(){return this.directives.length}_init(e){const t=Array.from(e.attributes);for(const n of t){const{name:t,value:r}=n;de.is(n)&&this.directives.push(new de(n,this));for(const n of B.directives){const i=n._match(t,e);if(i){const s={name:i.name,args:i.args?i.args.split("."):[],value:r};if(n.match(s,this)){const r=new n(s,this);r.init(),r.$options.$render&&this.directives.push(r),B.debug||e.removeAttribute(t);break}}}}}render(){for(const e of this.directives)e.render()}}var oe=t(function(e){(function(t,n){e.exports=n()})(K,function(){function e(r){e.waiting||t.then(e.flush),n.push(r)}const t=Promise.resolve(),n=e.queue=[];return Object.defineProperty(e,"waiting",{enumerable:!0,get(){return 0<n.length}}),e.afterFlush=t=>{setTimeout(()=>e.waiting?void e.afterFlush(t):t())},e.flush=()=>{if(e.waiting){const e=n.slice();n.length=0;for(const t of e)t()}},e})}),ce=/[|\\{}()[\]^$+*?.]/g,pe=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(ce,"\\$&")};class ue extends Event{constructor(e,t){super(e,t),this.$target=t.target,this.$stopped=!1,this.$performed=!1,this._transitionCb=t.transitionCb}stop(){this.$performed||(this.$stopped=!0)}play(){this.$performed||(this.$stopped=!1)}perform(){this.$stopped||this.$performed||(this.$stopped=!1,this.$performed=!0,this._transitionCb())}}const me=e=>e,he=/-([a-z0-9])/gi,ge=/(?<=[a-z0-9])([A-Z])/g,Ee="<name>";class $e extends le{constructor(e,t,n){super(e,t,A(n)),this.childrenRenderer=new Te((this.isPlaceholder?e.content:e).childNodes,t,this.isolated)}get isRenderable(){return super.isRenderable||0<this.childrenRenderer.renderers.length}get isFlattenable(){return 0<this.childrenRenderer.renderers.length&&!this.directives.length}render(){super.render(),(this.isPlaceholder||this.element.isConnected)&&this.childrenRenderer.render()}}class fe extends $e{constructor(e,t,n){super(e.cloneNode(!0),t.scope,A(t.isolated,n));const r=this.scope.$compiler.compileExpression(this.element.getAttribute("by"));this.by=e=>r(A(this.isolated,e)),this.reused=!1}get children(){return this.childrenRenderer.children}get key(){return this.by()}get next(){return(this.isPlaceholder?this.children[this.children.length-1]:this.element).nextSibling}update(e){this.reused=!0,Object.assign(this.isolated,e)}insert(e,t="enter",n=!0){if(!this.isPlaceholder){const r=()=>e.before(this.element);return n?this._dispatchTransitionEvent(t,this.element,r):r()}const r=t=>e.before(t);this.children.forEach(e=>{n?this._dispatchTransitionEvent(t,this.element,()=>r(e)):r(e)})}remove(){return this.isPlaceholder?this.children.forEach(e=>{this._dispatchTransitionEvent("leave",this.element,()=>e.remove())}):void this._dispatchTransitionEvent("leave",this.element,()=>{this.element.remove()})}_dispatchTransitionEvent(e,t,n){M(this.element,`for:${e}`,t,n)}}const ve="*for",be=/^\(?(?<value>\w+)(?:\s*,\s*(?<key>\w+)(?:\s*,\s*(?<index>\w+))?)?\)?\s+(?:in|of)\s+(?<expression>.+)$/;class _e{constructor(e,t){this.template=e,this.renderer=t,this.items=[],this.values=new Map;const n=y(e,ve),{groups:r}=n.match(be);this.keyName=r.key,this.indexName=r.index,this.valueName=r.value,this.startAnchor=x(`start for: ${n}`),this.endAnchor=x(`end for: ${n}`),this.getter=t.scope.$compiler.compileExpression(r.expression),e.replaceWith(this.startAnchor),this.startAnchor.nextSibling.before(this.endAnchor),e.hasAttribute("by")||(B.debug&&console.warn("The element with the loop expression `"+n+"` doesn't have a `by` attribute, fallbacking to `$index` tracking."),e.setAttribute("by","$index"))}static is({attributes:e}){return ve in e}render(){const e=this.getter(this.renderer.isolated),t=[],n=Object.keys(e);n.forEach((n,r)=>{let i=this.items[r];const s={$index:r,$key:n,[this.keyName]:n,[this.indexName]:r,[this.valueName]:e[n]};if(!i)i=new fe(this.template,this.renderer,s),i.insert(this.endAnchor),this.values.set(i.key,i);else{const e=i.by(s);if(i.key!==e){const t=this.values.get(e),n=t.next;t.insert(i.next,"move"),i.insert(n,null,!1),this.items[this.items.indexOf(t)]=i,this.items[r]=t,i=t}i.update(s)}t.push(i),i.render()});for(const e of this.items)e.reused?e.reused=!1:(this.values.delete(e.key.value),e.remove());this.items=t}}class Te{constructor(e,t,n){this.children=Array.from(e),this.scope=t,this.isolated=n,this.renderers=[],this._init()}_init(){for(const e of this.children)if(u(e)&&de.is(e))this.renderers.push(new de(e,this));else if(m(e))if(_e.is(e))this.renderers.push(new _e(e,this));else{const t=new(($(e)?e.content:e).childNodes.length?$e:le)(e,this.scope,this.isolated);t.isRenderable&&this.renderers.push(...(t.isFlattenable?O(t):[t]))}}render(){for(const e of this.renderers)e.render()}}var ye={$filter(e,t,...n){const r=B.filters[e];if(!r)throw new se(`Unknown filter '${e}'`);return r(t,...n)},$commit(e,...t){if(e in this){if(!h(this[e]))throw new se(`Method '${e}' must be a function`);if(E(e))throw new se(`Could no call reserved method '${e}'`);this[e](this.state,...t)}},$render(){this.$rendering||(this.$emit("$render:before"),this.$rendering=!0,oe(()=>{let t;try{this.$renderer.render()}catch(n){if(n instanceof se||(n=c(n)),B.debug)throw n;t=n}this.$rendering=!1,t&&this.$emit("$render:error",t)}))}},xe={$on(e,t,n){(this.$events[e]=P(this.$events,e)).push(t),this.addEventListener(e,t,n)},$once(e,t,n={}){"boolean"==typeof n&&(n={capture:n});const r=e=>{C(t),t.call(this,e)};n.once=!0,r.listener=t,this.$on(e,r,n)},$off(e,t){switch(arguments.length){case 0:for(e in this.$events)this.$off(e);break;case 1:for(const t of P(this.$events,e))this.$off(e,t);break;default:C(this.$events,e,t),this.removeEventListener(e,t);}},$emit(e,t){this.dispatchEvent(e instanceof Event?e:new CustomEvent(e,{detail:t}))}},Ae={connectedCallback(){let e=this;do e=e[e instanceof ShadowRoot?"host":"parentNode"];while(e&&!f(e));this.$parent=e,N(this,"attached")},disconnectedCallback(){this.$parent=null,N(this,"detached")},attributeChangedCallback(e,t,n){N(this,"attribute",{name:e,old:t,value:n})}},Se={__$n(e){return g(e)?e:""}};const Oe=new WeakMap,Ne={$plain:!1,$render:!0};class Pe{static get is(){return T(this.name)}constructor(e,t){if(this.$name=e.name,this.$args=e.args,this.$value=e.value,this.$renderer=t,this.$scope=t.scope,this.$compiler=this.$scope.$compiler,this.$element=t.element,this.$options=Object.assign({},Ne,this.constructor.options),!this.$options.$plain){const n=this.$compiler.compileExpression(e.value);this.$getter=e=>n(A(t.isolated,e))}}static get is(){return""}static match(){return!0}init(){}render(){}}Pe._matcher=null,Pe._match=function(e){const t=this._matcher.exec(e);return t&&t.groups};class Ce extends Pe{static get is(){return"*if"}get isPlaceholder(){return this.$renderer.isPlaceholder}init(){if(this.anchor=x(`if: ${this.$value}`),this.render=this.isPlaceholder?this._firstRenderMultiple:this._renderSingle,this.isPlaceholder&&(this.children=Array.from(this.$element.content.childNodes),!this.children.length))throw new se("placeholder element with a conditional must have at least one child node")}_renderSingle(){const{isConnected:e}=this.$element;let t;this.$getter()?!e&&(t="enter"):e&&(t="leave"),t&&this._dispatchTransitionEvent(t,this.$element,()=>{const e="leave"===t;this[e?"$element":"anchor"].replaceWith(this[e?"anchor":"$element"])})}_firstRenderMultiple(){this.$element.replaceWith(this.anchor),this.$getter()&&this._appendChildren(),this.render=this._renderMultiple}_renderMultiple(){if(this.$getter())this._appendChildren();else for(const e of this.children)e.isConnected&&this._dispatchTransitionEvent("leave",e,()=>e.remove())}_appendChildren(){let e=this.children.length;const{parentNode:t}=this.anchor;for(;e--;){const n=this.children[e];n.isConnected||this._dispatchTransitionEvent("enter",n,()=>{t.insertBefore(n,this.anchor.nextSibling)})}}_dispatchTransitionEvent(e,t,n){M(this.$element,`if:${e}`,t,n)}}class Le extends Pe{static get is(){return"@<name>"}static get options(){return{$plain:!0,$render:!1}}init(){const{$args:e,$name:t,$element:n,$renderer:r}=this,i=e.includes("once"),s=this.$compiler.compileEvent(this.$value);let a;const d=[];let l="addEventListener";e.includes("self")&&d.push((e,t)=>{t.target===t.currentTarget&&e(t)}),e.includes("prevent")&&d.push((e,t)=>{t.preventDefault(),e(t)}),f(n)?l=`$on${i?"ce":""}`:i&&d.push((e,r)=>{n.removeEventListener(t,a),e(r)}),d.push((e,t)=>{s(A(r.isolated,{$event:t})),e()}),n[l](t,a=R(d))}}class Re extends Pe{static get is(){return".<name>"}init(){this._inCustom=f(this.$element),this.$element[this.$name]=null}render(){this.$element[this.$name]=this.$getter(),this._inCustom&&this.$element.$render()}}class Me extends Pe{static get is(){return"ref"}init(){this.refName=_(this.$value)}render(){const{$scope:e,$element:t,refName:n}=this;t.isConnected?e.$refs[n]=t:delete e.$refs[n]}}class De extends Pe{static get is(){return":<name>"}_getObserved(){let e=this.$element.getAttributeNode(this.$name);return B.debug||this.$element.removeAttribute(this.$name),e||(e=document.createAttribute(this.$name),this.$element.setAttributeNode(e)),e}init(){this.attribute=this._getObserved()}render(){const e=this.$getter();"boolean"==typeof e?this.element[`${e?"set":"remove"}AttributeNode`](this.attribute):S(this.attribute,e)&&(this.attribute.value=e)}}class ke extends De{static get is(){return":class"}_getNormalized(){const e=this.$getter();if(!Array.isArray(e))return e;return e.forEach(e=>{p(e)?Object.assign(result,e):result[e]=1}),{}}render(){const e=this._getNormalized();if(!p(e))return super.render();for(const t in e)e.hasOwnProperty(t)&&this.$element.classList[e[t]?"add":"remove"](t)}}class Ie extends De{static get is(){return":style"}static parseRule(e){const t=e.split(".");return{prop:t[0],unit:t[1]}}init(){this.styles={}}render(){const e=this.$getter();if(!p(e))return super.render();const t=this.$element.attributeStyleMap;for(const n in this.styles)e.hasOwnProperty(n)||t.delete(Ie.parseRule(n).prop);for(const n in e){const r=e[n];if(this.styles[n]!==r){const{prop:e,unit:i}=Ie.parseRule(n);t[r?"set":"delete"](e,i?CSS[i](r):r)}}this.styles=Object.assign({},e)}}class we extends Pe{static get is(){return"*bind"}init(){this.setting=!1;const e=this.$compiler.compileSetter(this.$value);this.setter=t=>e(this.$renderer.isolated,t),this.onInput&&this.$element.addEventListener("input",this.onInput.bind(this)),this.onChange&&this.$element.addEventListener("change",this.onChange.bind(this))}static setMultiple(e,t,n){const r=n.indexOf(t);e?-1===r&&n.push(t):-1<r&&n.splice(r,1)}setValue(e){this.setting=!0,this.setter(e)}render(){this.setting?this.setting=!1:this.update(this.$element,this.$getter())}}class Ge extends we{static match(e,{element:t}){return"checkbox"===t.type}onChange({target:e}){const t=this.$getter();return Array.isArray(t)?void we.setMultiple(e.checked,e.value,t):this.setValue(e.checked)}update(e,t){e.checked=!!t}}class Be extends we{static match(e,{element:t}){return"radio"===t.type}onChange({target:e}){e.checked&&this.setValue(e.value)}update(e,t){e.checked=t+""===e.value}}class Ke extends we{static match(e,{element:t}){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement}init(){switch(super.init(),this.valueKey="value",this.$args[0]){case"number":this.valueKey+="AsNumber";break;case"date":this.valueKey+="AsDate";}}onInput({target:e}){this.setValue(e[this.valueKey])}update(e,t){e[this.valueKey]!==t&&(e[this.valueKey]=t)}}class Ue extends we{static match(e,{element:t}){return t instanceof HTMLSelectElement}onChange({target:e}){const{options:t,multiple:n}=e;if(!n){for(const{value:e,selected:n}of t)if(n)return this.setValue(e);}else{const e=this.$getter();if(!Array.isArray(e))throw new se("Invalid bound value. *bind directive on select elements with a `multiple` attribute must have an array bound value.");for(const n of t)we.setMultiple(n.selected,n.value,e)}}update(e,t){for(const n of e.options)n.selected=e.multiple?-1<t.indexOf(n.value):t===n.value}}class Fe{static init(){}static install(){}static with(e){return Object.assign(this.$options,this.$defaults,e),this}}_defineProperty(Fe,"$options",{}),_defineProperty(Fe,"$defaults",{});const Ve=k(HTMLElement);e.config=B,e.extend=k,e.GalaxyElement=Ve,e.html=function(...e){return I("template",...e)},e.css=function(...e){const t=I("style",...e);return t.setAttribute("skip",""),t},e.setup=function(e){if(Object.assign(B,e),B.plugins)for(const e of B.plugins)e.init(B);B.directives.unshift(...[Ce,Le,Re,Me,ke,Ie,De,Ge,Be,Ke,Ue]);for(const t of B.directives)t._matcher=v(t.is);if(!B.root)throw new se("You must include a `root` option");w([B.root,...B.elements],B.plugins)},e.GalaxyDirective=Pe,e.GalaxyPlugin=Fe,e.withCachedInstance=function(e){const t=e.init;return e.init=function(n){this.$instance=new e(this.$options),t.call(this,n)},e},Object.defineProperty(e,"__esModule",{value:!0})});