function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Galaxy={})})(this,function(a){"use strict";function b(a,b){return b={exports:{}},a(b,b.exports),b.exports}function c(a){return null!==a&&"object"==typeof a}function d(a){return a.nodeType===Node.TEXT_NODE}function e(a){return a.nodeType===Node.ELEMENT_NODE}function f(a){return"function"==typeof a}function g(a){return null!=a}function h(a){return a.startsWith("$")||a.startsWith("_")}function i({constructor:a}){return-1<H.elements.indexOf(a)}function j(a){let b,c=a;for(;b=L.exec(a);){const{index:d,groups:e}=b,f=d+b[0].length;let g=1,h=f,i=!1,j=!1;loop:for(;g;){const b=!i&&!j;switch(a.charCodeAt(h++)){case 40:b&&++g;break;case 41:b&&--g;break;case 34:j||(i=!i);break;case 39:i||(j=!j);break;case NaN:break loop;}}const k=a.slice(f,h-1);c=c.replace(a.slice(d,h),`$commit('${e.name}'${k?`, ${k}`:""})`)}return c}function k(a){let b;const c=[];for(;b=M.exec(a);){const d=a.slice(0,b.index);let e=b.groups.expression.trim();if(d&&c.push(`\`${d}\``),e){const a=e.split(N);c.push(`_$n(${1<a.length?`_$f(${a[0]}, [${l(a.slice(1)).join()}])`:e})`)}a=a.slice(b.index+b[0].length)}return a&&c.push(`\`${a}\``),c.join(" + ")}function l(a){return a.map(a=>{const{groups:b}=O.exec(a.trim());return`{
      name: '${b.name}',
      args: ${b.args?`[${b.args}]`:"null"}
    }`})}function m(a){return o(`return ${a}`)}function n(a){return o(`(${a} = __args__[0])`)}function o(a){let b=P.get(a);return b||(b=new Function("__global__","__scope__","__locals__","...__args__",`with (__global__) {
        with (__scope__) {
          with (state) {
            with (__locals__) {
              ${a}
            }
          }
        }
      }`),P.set(a,b)),(a,c,...d)=>b(K,a,c,...d)}function p(a){return a.replace(T,(a,b)=>b.toUpperCase())}function q(a){return a.replace(U,(a,b)=>`-${b.toLowerCase()}`).toLowerCase()}function r(a,b,c=S){const d=c(a.getAttribute(b));return H.debug||a.removeAttribute(b),d}function s(a){return H.debug?new Comment(` ${a} `):new Text}function t(...a){return Object.assign(Object.create(null),...a)}function u(a,b){return a.nodeValue!==b}function v(a){const b=[];return a.childrenRenderer.renderers.forEach(a=>{b.push(...(a.isFlattenable?v(a):[a]))}),b}function w(a){return a.is||a.name&&q(a.name)}function x(a,b,c){a.$emit(`$${b}`,c),b=a[`on${b.charAt(0).toUpperCase()+b.slice(1)}`],f(b)&&R.afterFlush(()=>{b.call(a,c)})}function y(a,b){return a[b]||[]}function z({message:a,stack:b}){const c=new ba(a);return c.stack=b,c}function A({name:a}){return a.startsWith(ja)}function B({name:a},{element:b,scope:c,isolated:d}){const e=r(b,a),f=o(j(e)),g=C(a),{modifiers:h}=g;let k,l="addEventListener",m=a=>{c.$event=a,f(c,d),c.$event=null};h.self&&(k=m,m=a=>{a.target===a.currentTarget&&k(a)}),h.prevent&&(k=m,m=a=>{a.preventDefault(),k(a)}),i(b)?l=`$on${h.once?"ce":""}`:h.once&&(k=m,m=a=>{b.removeEventListener(g.name,m),k(a)}),b[l](g.name,m)}function C(a){const b={},c=a.split(ka);if(1<c.length)for(let a=1;a<c.length;a++)b[c[a]]=!0;return{name:c[0].slice(1),modifiers:b}}function D(a){class b extends a{constructor(){super(),_defineProperty(this,"$event",null),_defineProperty(this,"$events",Object.create(null)),_defineProperty(this,"$parent",null),_defineProperty(this,"$children",{}),_defineProperty(this,"$refs",new Map),_defineProperty(this,"$rendering",!1);let a;const{style:b,template:c}=this.constructor;try{a=this.attachShadow({mode:"open"})}catch(a){}if(b instanceof HTMLStyleElement){if(!a)throw new ba("style cannot be attached");a.appendChild(b.cloneNode(!0))}if(c instanceof HTMLTemplateElement){if(!a)throw new ba("template cannot be attached");a.appendChild(c.content.cloneNode(!0))}this.$name=w(this.constructor),this.state={},this.$renderer=new va(a?a.childNodes:[],this,{}),x(this,"created")}get state(){return wa.get(this)}set state(a){const b=()=>{this.$render()};wa.set(this,J.observe(a,null,b)),b()}connectedCallback(){let a=this;do a=a instanceof ShadowRoot?a.host:a.parentNode;while(a&&!i(a));a&&i(a)&&(this.$parent=a,a.$children[p(this.$name)]=this),x(this,"attached")}disconnectedCallback(){this.$parent&&(delete this.$parent.$children[p(this.$name)],this.$parent=null),x(this,"detached")}attributeChangedCallback(a,b,c){x(this,"attribute",{name:a,old:b,value:c})}$commit(a,...b){if(a in this){if(!f(this[a]))throw new ba(`Method '${a}' must be a function`);if(h(a))throw new ba(`Could no call reserved method '${a}'`);this[a](this.state,...b)}}$render(){this.$rendering||(this.$rendering=!0,R(()=>{let a;this.$refs.clear();try{this.$renderer.render()}catch(b){if(b instanceof ba||(b=z(b)),H.debug)throw b;a=b}this.$rendering=!1,a&&this.$emit("$render:error",a)}))}}return b.extendsBuiltIn=a!==HTMLElement,b}function E(a){Object.assign(H,a),"plugins"in a&&G(a.plugins);for(const b of a.elements){let a={};const c=w(b);if(!c)throw new ba("Unknown element tag name");if(b.extendsBuiltIn&&!(a.extends=b.extends))throw new ba("Extended customized built-in elements must have an `extends` property");try{customElements.define(c,b,a)}catch(a){throw z(a)}}}function F(a,...b){const c=document.createElement(a);return c.innerHTML=String.raw(...b),c}function G(a){const b=Object.assign.bind(null,za.prototype);for(const c in a){const d=a[c];if(null!==d&&"object"==typeof d)b(d);else if("function"==typeof d)d(za);else throw new ba(`plugin '${c}' must be an object or function`)}}var H={debug:!0,plugins:{},filters:{},elements:[]},I="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,J=b(function(a){(function(b,c){a.exports=c()})(I,function(){const a=new WeakMap,b=Object.prototype.hasOwnProperty,c=a=>"[object Object]"===Object.prototype.toString.call(a)||Array.isArray(a),d=()=>{};class e{constructor(a){this.target=a,this.subscribers=new Set}static get observeOptions(){return{deep:!0,compare(a,b){return JSON.stringify(a)!==JSON.stringify(b)}}}static is(b){return c(b)&&a.has(b)}static get(b){return a.get(b)}static observe(f,g={},h=d){function i(a){h(a),l.dispatch(a)}if(e.is(f))return f;const{deep:j,compare:k}=Object.assign({},e.observeOptions,g),l=new e(f);if(j)for(const a in f)if(b.call(f,a)){const b=f[a];c(b)&&(f[a]=e.observe(b,g,i))}const m=new Proxy(f,{defineProperty(a,d,f){const{value:h}=f,l=a[d],m=b.call(a,d);j&&c(h)&&(f.value=e.observe(h,g,i));const n=Reflect.defineProperty(a,d,f);if(n&&(!m||k(h,l,d,a))){const b={type:m?"set":"add",value:h,property:d,target:a};m&&(b.old=l),i(b)}return n},deleteProperty(a,c){const d=a[c],e=b.call(a,c)&&Reflect.deleteProperty(a,c);return e&&i({type:"delete",old:d,property:c,target:a}),e}});return a.set(f,l),a.set(m,l),m}subscribe(a){return this.subscribers.add(a),this}unsubscribe(a){return this.subscribers.delete(a),this}dispatch(a){return this.subscribers.forEach(b=>{b(a,this.target)}),this}}return e})}),K={_$f(a,b){return b.reduce((a,b)=>{const c=H.filters[b.name];return b.args?c(a,...b.args):c(a)},a)},_$n(a){return g(a)?a:""}};const L=/#(?<name>\w+)\(/g,M=/{{(?<expression>.*?)}}/,N=/(?<!\|)\|(?!\|)/,O=/^(?<name>\w+)(?:\((?<args>.*)\))?$/,P=new Map;class Q{constructor(a,b,c){this.target=a,this.context=b,this.expression=c;const d=m(c);this.getter=(a=b.isolated)=>d(b.scope,a)}get value(){return this.getter()}render(){this.patch(this.target,this.value)}}var R=b(function(a){(function(b,c){a.exports=c()})(I,function(){function a(d){a.waiting||b.then(a.flush),c.push(d)}const b=Promise.resolve(),c=a.queue=[];return Object.defineProperty(a,"waiting",{enumerable:!0,get(){return 0<c.length}}),a.afterFlush=b=>{setTimeout(()=>a.waiting?void a.afterFlush(b):b())},a.flush=()=>{if(a.waiting){const a=c.slice();c.length=0;for(const b of a)b()}},a})});const S=a=>a,T=/-([a-z0-9])/gi,U=/(?<=[a-z0-9])([A-Z])/g;class V extends Q{constructor(a,b){super(a,b,k(a.nodeValue))}static is({nodeValue:a}){return M.test(a)}patch(a,b){const c=g(b)?b+"":"";u(a,c)&&(a.nodeValue=c)}}const W="*if";class X extends Q{constructor(a,b){super(a,b,r(a,W)),this.anchor=s(`if: ${this.condition}`)}static is({attributes:a}){return W in a}patch(a,b){b?!a.isConnected&&this.anchor.parentNode.replaceChild(a,this.anchor):a.isConnected&&a.parentNode.replaceChild(this.anchor,a)}}const Y="*bind";class Z extends Q{constructor(a,b){super(a,b,r(a,Y)),this.setting=!1;const c=n(this.expression);this.setter=a=>{c(b.scope,b.isolated,a)},this.onInput&&a.addEventListener("input",this.onInput.bind(this)),this.onChange&&a.addEventListener("change",this.onChange.bind(this))}static is({attributes:a}){return Y in a}static setMultiple(a,b,c){const d=c.indexOf(b);a?-1===d&&c.push(b):-1<d&&c.splice(d,1)}setValue(a){this.setting=!0,this.setter(a)}patch(a,b){this.setting?this.setting=!1:this.update(a,b)}}class $ extends Z{constructor(a,b){super(a,b),this.conversor="number"===a.type?Number:String}static is(a){return a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement}onInput({target:a}){this.setValue(this.conversor(a.value))}update(a,b){b=b+"",u(a,b)&&(a.value=b)}}class _ extends Z{static is({type:a}){return"checkbox"===a}onChange({target:a}){const b=this.getter();return Array.isArray(b)?void Z.setMultiple(a.checked,a.value,b):this.setValue(a.checked)}update(a,b){a.checked=!!b}}class aa extends Z{static is({type:a}){return"radio"===a}onChange({target:a}){a.checked&&this.setValue(a.value)}update(a,b){a.checked=b+""===a.value}}class ba extends Error{}class ca extends Z{static is(a){return a instanceof HTMLSelectElement}onChange({target:a}){const{options:b,multiple:c}=a;if(!c){for(const{value:a,selected:c}of b)if(c)return this.setValue(a);}else{const a=this.getter();if(!Array.isArray(a))throw new ba("Invalid bound value. *bind directive on select elements with a `multiple` attribute must have an array bound value.");for(const c of b)Z.setMultiple(c.selected,c.value,a)}}update(a,b){for(const c of a.options)c.selected=a.multiple?-1<b.indexOf(c.value):b===c.value}}const da=":".repeat(2);class ea extends Q{constructor(a,b){let c=a.name.startsWith(da);if(super(ea.getObserved(a,c),b,a.value),this.oneTime=c,this.owner=this.target.ownerElement,this.name=this.target.name,c){const a=this.patch;this.patch=c=>{const{bindings:d}=b;a.call(this,c),R(()=>{d.splice(d.indexOf(this),1)})}}}static is({name:a}){return a.startsWith(":")}static getObserved(a,b){const{name:c}=a,{attributes:d}=a.ownerElement,e=c.slice(b?2:1);let f=d.getNamedItem(e);return H.debug||d.removeNamedItem(c),f||(f=document.createAttribute(e),d.setNamedItem(f)),f}patch(a,b){u(a,b)&&(a.value=b)}}const fa=/^:{1,2}class$/;class ga extends ea{static is({name:a}){return fa.test(a)}static getNormalized(a){if(!Array.isArray(a))return a;const b={};return a.forEach(a=>{c(a)?Object.assign(b,a):b[a]=1}),b}patch(a,b){if(b=ga.getNormalized(b),!c(b))return super.patch(a,b);const{classList:d}=this.owner;for(const c in b)b.hasOwnProperty(c)&&d[b[c]?"add":"remove"](c)}}const ha=/^:{1,2}style$/;class ia extends ea{constructor(...a){super(...a),this.styles={}}static is({name:a}){return ha.test(a)}static parseRule(a){const b=a.split(".");return{prop:b[0],unit:b[1]}}patch(a,b){if(!c(b))return super.patch(a,b);const d=this.owner.attributeStyleMap;for(const c in this.styles)b.hasOwnProperty(c)||d.delete(ia.parseRule(c).prop);for(const c in b){const a=b[c];if(this.styles[c]!==a){const{prop:b,unit:e}=ia.parseRule(c);d.set(b,e?CSS[e](a):a)}}this.styles=Object.assign({},b)}}const ja="@",ka=".",la="ref",ma=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];class na{constructor(a,b,c){this.element=a,this.scope=b,this.isolated=c,this.directives=[],this.bindings=[],this._initDirectives(a),this._initBindings(a)}static is({tagName:a}){return-1<ma.indexOf(a.toLowerCase())}get isRenderable(){return 0<this.directives.length||0<this.bindings.length||this.element.hasAttribute(la)}_initDirectives(a){if(X.is(a)&&this.directives.push(new X(a,this)),Z.is(a)){const b=_.is(a)?_:aa.is(a)?aa:$.is(a)?$:ca.is(a)?ca:null;b&&this.directives.push(new b(a,this))}}_initBindings(a){const b=Array.from(a.attributes);for(const c of b)if(A(c))B(c,this);else if(V.is(c))this.bindings.push(new V(c,this));else if(ea.is(c)){const a=new(ga.is(c)?ga:ia.is(c)?ia:ea)(c,this);this.bindings[a.name]=a,this.bindings.push(a)}}render(){const a=this.element;for(const a of this.directives)a.render();if(a.isConnected){for(const a of this.bindings)a.render();const b=a.getAttribute(la);b&&this.scope.$refs.set(b,a)}}}class oa extends na{constructor(a,b,c){super(a,b,t(c)),this.childrenRenderer=new va(a.childNodes,b,this.isolated)}get isRenderable(){return super.isRenderable||0<this.childrenRenderer.renderers.length}get isFlattenable(){return 0<this.childrenRenderer.renderers.length&&!this.directives.length&&!this.bindings.length}render(){super.render(),this.element.isConnected&&this.childrenRenderer.render()}}class pa extends oa{constructor(a,b,c){super(a,b,c),this.properties=[],this._resolveProps(a)}static is(a){return i(a)}_resolveProps(a){const{constructor:b,attributes:c}=a,{properties:d}=b;for(const{name:b}of Array.from(c))if(b.startsWith(".")){const c=p(b.slice(1));d.hasOwnProperty(c)&&(a[c]=d[c],this.properties.push({property:c,getter:m(r(a,b))}))}}render(){super.render();for(const{property:a,getter:b}of this.properties)this.element[a]=b(this.scope,this.isolated);this.element.isConnected&&this.element.$render()}}class qa{constructor(a,b,c){const d=qa.getRenderer(a);this.renderer=new d(a.cloneNode(!0),b.scope,t(b.isolated,c)),this.reused=!1}static getRenderer(a){return i(a)?pa:oa}get key(){return this.renderer.bindings.by}get next(){return this.renderer.element.nextSibling}by(a){return this.key.getter(a)}update(a){this.reused=!0,Object.assign(this.renderer.isolated,a)}insert(a){a.parentNode.insertBefore(this.renderer.element,a)}remove(){this.renderer.element.remove()}render(){this.renderer.render()}}const ra="*for",sa=/^\(?(?<value>\w+)(?:\s*,\s*(?<key>\w+)(?:\s*,\s*(?<index>\w+))?)?\)?\s+in\s+(?<expression>.+)$/;class ta extends Q{constructor(a,b){const c=r(a,ra),{groups:d}=c.match(sa);super(a,b,d.expression),this.items=[],this.values=new Map,this.keyName=d.key,this.indexName=d.index,this.valueName=d.value,this.startAnchor=s(`start for: ${d.expression}`),this.endAnchor=s(`end for: ${d.expression}`);const e=a.parentNode;e.replaceChild(this.startAnchor,a),e.insertBefore(this.endAnchor,this.startAnchor.nextSibling),a.hasAttribute(":by")||(H.debug&&console.warn("The element with the loop expression `"+c+"` doesn't have a `by` binding, defaulting to `$index` tracking."),a.setAttribute(":by","$index"))}static is({attributes:a}){return ra in a}patch(a,b){const c=[],d=Object.keys(b);d.forEach((d,e)=>{let f=this.items[e];const g={$index:e,$key:d,[this.keyName]:d,[this.indexName]:e,[this.valueName]:b[d]};if(!f)f=new qa(a,this.context,g),f.insert(this.endAnchor),this.values.set(f.key.value,f);else{const a=f.by(g);if(f.key.value!==a){const b=this.values.get(a),c=b.next;b.insert(f.next),f.insert(c),this.items[this.items.indexOf(b)]=f,this.items[e]=b,f=b}f.update(g)}c.push(f),f.render()});for(const c of this.items)c.reused?c.reused=!1:(this.values.delete(c.key.value),c.remove());this.items=c}}const ua="skip";class va{constructor(a,b,c){this.children=Array.from(a),this.scope=b,this.isolated=c,this.renderers=[],this._initChildren()}_initChildren(){for(const a of this.children)if(d(a)&&V.is(a))this.renderers.push(new V(a,this));else if(e(a)){if(a.hasAttribute(ua)){H.debug||a.removeAttribute(ua);continue}if(ta.is(a))this.renderers.push(new ta(a,this));else if(pa.is(a))this.renderers.push(new pa(a,this.scope,this.isolated));else{const b=new(na.is(a)?na:oa)(a,this.scope,this.isolated);b.isRenderable&&this.renderers.push(...(b.isFlattenable?v(b):[b]))}}}render(){for(const a of this.renderers)a.render()}}const wa=new WeakMap;var xa={$on(a,b,c){(this.$events[a]=y(this.$events,a)).push(b),this.addEventListener(a,b,c)},$once(a,b,c){const d=c=>{this.$off(a,d),b(c)};d.listener=b,this.$on(a,d,c)},$off(a,b){switch(arguments.length){case 0:for(a in this.$events)this.$off(a);break;case 1:for(const b of y(this.$events,a))this.$off(a,b);break;default:{const c=y(this.$events,a).filter(a=>a!==b);c.length?this.$events[a]=c:delete this.$events[a],this.removeEventListener(a,b)}}},$emit(a,b){this.dispatchEvent(a instanceof Event?a:new CustomEvent(a,{detail:b}))}},ya={$watch(a,b){let c,d,{state:e}=this;const f=a.split(".");if(f.forEach((a,g)=>{if(g===f.length-1)c=J.get(e),d="*"===a?a=>{b(a.value,a.old,a.property,a.target)}:c=>{c.property===a&&b(c.value,c.old)};else if(e=e[a],!e)throw new GalaxyError(`Wrong path at segment: '.${a}'`)}),c&&d)return c.subscribe(d),()=>{c.unsubscribe(d)}}};const za=D(HTMLElement);(function(a,b){return Object.assign(a.prototype,...b)})(za,[xa,ya]),a.extend=D,a.config=H,a.GalaxyElement=za,a.html=function(...a){return F("template",...a)},a.css=function(...a){const b=F("style",...a);return b.setAttribute("skip",""),b},a.setup=E,Object.defineProperty(a,"__esModule",{value:!0})});