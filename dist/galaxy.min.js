function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Galaxy={})})(this,function(a){"use strict";function b(a,b){return b={exports:{}},a(b,b.exports),b.exports}function c(a){return null!==a&&"object"==typeof a}function d(a){return a.nodeType===Node.TEXT_NODE}function e(a){return a.nodeType===Node.ELEMENT_NODE}function f(a){return"function"==typeof a}function g(a){return null!=a}function h(a){return a.startsWith("$")||a.startsWith("_")}function i({constructor:a}){return-1<H.elements.indexOf(a)}function j(a){let b,c=a;for(;b=M.exec(a);){const{index:d,groups:e}=b,f=d+b[0].length;let g=1,h=f,i=!1,j=!1;loop:for(;g;){const b=!i&&!j;switch(a.charCodeAt(h++)){case 40:b&&++g;break;case 41:b&&--g;break;case 34:j||(i=!i);break;case 39:i||(j=!j);break;case NaN:break loop;}}const k=a.slice(f,h-1);c=c.replace(a.slice(d,h),`$commit('${e.name}'${k?`, ${k}`:""})`)}return c}function k(a){let b;const c=[];for(;b=N.exec(a);){const d=a.slice(0,b.index);let e=b.groups.expression.trim();if(d&&c.push(`\`${d}\``),e){const a=e.split(O);c.push(`_$n(${1<a.length?`_$f(${a[0]}, [${l(a.slice(1)).join()}])`:e})`)}a=a.slice(b.index+b[0].length)}return a&&c.push(`\`${a}\``),c.join(" + ")}function l(a){return a.map(a=>{const{groups:b}=P.exec(a.trim());return`{      name: '${b.name}',      args: ${b.args?`[${b.args}]`:"null"}    }`})}function m(a){return o(`return ${a}`)}function n(a){return o(`(${a} = __args__[0])`)}function o(a){let b=Q.get(a);return b||(b=new Function("__global__","__scope__","__locals__","...__args__",`with (__global__) {        with (__scope__) {          with (state) {            with (__locals__) {              ${a}            }          }        }      }`),Q.set(a,b)),(a,c,...d)=>b(L,a,c,...d)}function p(a){a=T(a);const b=a.replace(X,q("[\\w-]+"));return new RegExp(`^${b===a?q(a):b}(?:.(?<args>.+))?$`)}function q(a){return`(?${"<name>"}${a})`}function r(a){return a.replace(V,(a,b)=>b.toUpperCase())}function s(a){return a.replace(W,(a,b)=>`-${b.toLowerCase()}`).toLowerCase()}function t(a,b,c=U){const d=c(a.getAttribute(b));return H.debug||a.removeAttribute(b),d}function u(a){return H.debug?new Comment(` ${a} `):new Text}function v(...a){return Object.assign(Object.create(null),...a)}function w(a,b){return a.nodeValue!==b}function x(a){const b=[];return a.childrenRenderer.renderers.forEach(a=>{b.push(...(a.isFlattenable?x(a):[a]))}),b}function y(a){return a.is||a.name&&s(a.name)}function z(a,b,c){a.$emit(`$${b}`,c),b=a[`on${b.charAt(0).toUpperCase()+b.slice(1)}`],f(b)&&J.afterFlush(()=>{b.call(a,c)})}function A(a,b){return a[b]||[]}function B(a,b){return Object.assign(a.prototype,...b)}function C({message:a,stack:b}){const c=new ga(a);return c.stack=b,c}function D(a){class b extends a{constructor(){super(),_defineProperty(this,"$event",null),_defineProperty(this,"$events",Object.create(null)),_defineProperty(this,"$parent",null),_defineProperty(this,"$children",{}),_defineProperty(this,"$rendering",!1);let a;const{style:b,template:c}=this.constructor;try{a=this.attachShadow({mode:"open"})}catch(a){}if(b instanceof HTMLStyleElement){if(!a)throw new ga("style cannot be attached");a.appendChild(b.cloneNode(!0))}if(c instanceof HTMLTemplateElement){if(!a)throw new ga("template cannot be attached");a.appendChild(c.content.cloneNode(!0))}this.$name=y(this.constructor),this.state={},this.$renderer=new da(a?a.childNodes:[],this,{}),z(this,"created")}get state(){return ha.get(this)}set state(a){const b=()=>{this.$render()};ha.set(this,K.observe(a,null,b)),b()}connectedCallback(){let a=this;do a=a instanceof ShadowRoot?a.host:a.parentNode;while(a&&!i(a));a&&i(a)&&(this.$parent=a,a.$children[r(this.$name)]=this),z(this,"attached")}disconnectedCallback(){this.$parent&&(delete this.$parent.$children[r(this.$name)],this.$parent=null),z(this,"detached")}attributeChangedCallback(a,b,c){z(this,"attribute",{name:a,old:b,value:c})}$commit(a,...b){if(a in this){if(!f(this[a]))throw new ga(`Method '${a}' must be a function`);if(h(a))throw new ga(`Could no call reserved method '${a}'`);this[a](this.state,...b)}}$render(){this.$rendering||(this.$emit("$render:before"),this.$rendering=!0,J(()=>{let a;try{this.$renderer.render()}catch(b){if(b instanceof ga||(b=C(b)),H.debug)throw b;a=b}this.$rendering=!1,a&&this.$emit("$render:error",a)}))}}return b.extendsBuiltIn=a!==HTMLElement,B(b,[ea,fa]),b}function E(a){Object.assign(H,a),"plugins"in H&&G(a.plugins),H.directives.unshift(...[ja,ka,la,ma,oa,pa,na,ra,sa,ta,ua]);for(const b of H.directives)b._matcher=p(b.is);for(const b of H.elements){let a={};const c=y(b);if(!c)throw new ga("Unknown element tag name");if(b.extendsBuiltIn&&!(a.extends=b.extends))throw new ga("Extended customized built-in elements must have an `extends` property");try{customElements.define(c,b,a)}catch(a){throw C(a)}}}function F(a,...b){const c=document.createElement(a);return c.innerHTML=String.raw(...b),c}function G(a){const b=Object.assign.bind(null,va.prototype);for(const c in a){const d=a[c];if(null!==d&&"object"==typeof d)b(d);else if("function"==typeof d)d(va);else throw new ga(`plugin '${c}' must be an object or function`)}}var H={debug:!0,plugins:{},filters:{},elements:[],directives:[]},I="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,J=b(function(a){(function(b,c){a.exports=c()})(I,function(){function a(d){a.waiting||b.then(a.flush),c.push(d)}const b=Promise.resolve(),c=a.queue=[];return Object.defineProperty(a,"waiting",{enumerable:!0,get(){return 0<c.length}}),a.afterFlush=b=>{setTimeout(()=>a.waiting?void a.afterFlush(b):b())},a.flush=()=>{if(a.waiting){const a=c.slice();c.length=0;for(const b of a)b()}},a})}),K=b(function(a){(function(b,c){a.exports=c()})(I,function(){const a=new WeakMap,b=Object.prototype.hasOwnProperty,c=a=>"[object Object]"===Object.prototype.toString.call(a)||Array.isArray(a),d=()=>{};class e{constructor(a){this.target=a,this.subscribers=new Set}static get observeOptions(){return{deep:!0,compare(a,b){return JSON.stringify(a)!==JSON.stringify(b)}}}static is(b){return c(b)&&a.has(b)}static get(b){return a.get(b)}static observe(f,g={},h=d){function i(a){h(a),l.dispatch(a)}if(e.is(f))return f;const{deep:j,compare:k}=Object.assign({},e.observeOptions,g),l=new e(f);if(j)for(const a in f)if(b.call(f,a)){const b=f[a];c(b)&&(f[a]=e.observe(b,g,i))}const m=new Proxy(f,{defineProperty(a,d,f){const{value:h}=f,l=a[d],m=b.call(a,d);j&&c(h)&&(f.value=e.observe(h,g,i));const n=Reflect.defineProperty(a,d,f);if(n&&(!m||k(h,l,d,a))){const b={type:m?"set":"add",value:h,property:d,target:a};m&&(b.old=l),i(b)}return n},deleteProperty(a,c){const d=a[c],e=b.call(a,c)&&Reflect.deleteProperty(a,c);return e&&i({type:"delete",old:d,property:c,target:a}),e}});return a.set(f,l),a.set(m,l),m}subscribe(a){return this.subscribers.add(a),this}unsubscribe(a){return this.subscribers.delete(a),this}dispatch(a){return this.subscribers.forEach(b=>{b(a,this.target)}),this}}return e})}),L={_$f(a,b){return b.reduce((a,b)=>{const c=H.filters[b.name];return b.args?c(a,...b.args):c(a)},a)},_$n(a){return g(a)?a:""}};const M=/#(?<name>\w+)\(/g,N=/{{(?<expression>.*?)}}/,O=/(?<!\|)\|(?!\|)/,P=/^(?<name>\w+)(?:\((?<args>.*)\))?$/,Q=new Map;class R{constructor(a,b,c){this.target=a,this.context=b,this.expression=c;const d=m(c);this.getter=a=>d(b.scope,Object.assign({},b.isolated,a))}get value(){return this.getter()}render(){this.patch(this.target,this.value)}}var S=/[|\\{}()[\]^$+*?.]/g,T=function(a){if("string"!=typeof a)throw new TypeError("Expected a string");return a.replace(S,"\\$&")};const U=a=>a,V=/-([a-z0-9])/gi,W=/(?<=[a-z0-9])([A-Z])/g,X="<name>";class Y extends R{constructor(a,b){super(a,b,k(a.nodeValue))}static is({nodeValue:a}){return N.test(a)}patch(a,b){const c=g(b)?b+"":"";w(a,c)&&(a.nodeValue=c)}}class Z{constructor(a,b,c){this.scope=b,this.element=a,this.isolated=c,this.locals=Object.create(null),this.directives=[],this._init(a)}get isRenderable(){return this.directives.length}_init(a){const b=Array.from(a.attributes);for(const c of b){const{name:b,value:d}=c;Y.is(c)&&this.directives.push(new Y(c,this));for(const c of H.directives){const e=c._match(b,a);if(e){const f={name:e.name,args:e.args?e.args.split("."):[],value:d};if(c.match(f,this)){this.directives.push(new c(f,this)),H.debug||a.removeAttribute(b);break}}}}}render(){for(const a of this.directives)a.render()}}class $ extends Z{constructor(a,b,c){super(a,b,v(c)),this.childrenRenderer=new da(a.childNodes,b,this.isolated)}get isRenderable(){return super.isRenderable||0<this.childrenRenderer.renderers.length}get isFlattenable(){return 0<this.childrenRenderer.renderers.length&&!this.directives.length}render(){super.render(),this.childrenRenderer.render()}}class _ extends ${constructor(a,b,c){super(a.cloneNode(!0),b.scope,v(b.isolated,c));const d=m(this.element.getAttribute("by"));this.by=a=>d(b.scope,Object.assign({},this.isolated,a)),this.reused=!1}get key(){return this.by()}get next(){return this.element.nextSibling}update(a){this.reused=!0,Object.assign(this.isolated,a)}insert(a){a.before(this.element)}remove(){this.element.remove()}}const aa="*for",ba=/^\(?(?<value>\w+)(?:\s*,\s*(?<key>\w+)(?:\s*,\s*(?<index>\w+))?)?\)?\s+in\s+(?<expression>.+)$/;class ca extends R{constructor(a,b){const c=t(a,aa),{groups:d}=c.match(ba);super(a,b,d.expression),this.items=[],this.values=new Map,this.keyName=d.key,this.indexName=d.index,this.valueName=d.value,this.startAnchor=u(`start for: ${d.expression}`),this.endAnchor=u(`end for: ${d.expression}`),a.replaceWith(this.startAnchor),this.startAnchor.nextSibling.before(this.endAnchor),a.hasAttribute("by")||(H.debug&&console.warn("The element with the loop expression `"+c+"` doesn't have a `by` attribute, fallbacking to `$index` tracking."),a.setAttribute("by","$index"))}static is({attributes:a}){return aa in a}patch(a,b){const c=[],d=Object.keys(b);d.forEach((d,e)=>{let f=this.items[e];const g={$index:e,$key:d,[this.keyName]:d,[this.indexName]:e,[this.valueName]:b[d]};if(!f)f=new _(a,this.context,g),f.insert(this.endAnchor),this.values.set(f.key,f);else{const a=f.by(g);if(f.key!==a){const b=this.values.get(a),c=b.next;b.insert(f.next),f.insert(c),this.items[this.items.indexOf(b)]=f,this.items[e]=b,f=b}f.update(g)}c.push(f),f.render()});for(const c of this.items)c.reused?c.reused=!1:(this.values.delete(c.key.value),c.remove());this.items=c}}class da{constructor(a,b,c){this.children=Array.from(a),this.scope=b,this.isolated=c,this.renderers=[],this._init()}_init(){for(const a of this.children)if(d(a)&&Y.is(a))this.renderers.push(new Y(a,this));else if(e(a))if(ca.is(a))this.renderers.push(new ca(a,this));else{const b=new(a.childNodes.length?$:Z)(a,this.scope,this.isolated);b.isRenderable&&this.renderers.push(...(b.isFlattenable?x(b):[b]))}}render(){for(const a of this.renderers)a.render()}}var ea={$on(a,b,c){(this.$events[a]=A(this.$events,a)).push(b),this.addEventListener(a,b,c)},$once(a,b,c){const d=c=>{this.$off(a,d),b(c)};d.listener=b,this.$on(a,d,c)},$off(a,b){switch(arguments.length){case 0:for(a in this.$events)this.$off(a);break;case 1:for(const b of A(this.$events,a))this.$off(a,b);break;default:{const c=A(this.$events,a).filter(a=>a!==b);c.length?this.$events[a]=c:delete this.$events[a],this.removeEventListener(a,b)}}},$emit(a,b){this.dispatchEvent(a instanceof Event?a:new CustomEvent(a,{detail:b}))}},fa={$watch(a,b){let c,d,{state:e}=this;const f=a.split(".");if(f.forEach((a,g)=>{if(g===f.length-1)c=K.get(e),d="*"===a?a=>{b(a.value,a.old,a.property,a.target)}:c=>{c.property===a&&b(c.value,c.old)};else if(e=e[a],!e)throw new GalaxyError(`Wrong path at segment: '.${a}'`)}),c&&d)return c.subscribe(d),()=>{c.unsubscribe(d)}}};class ga extends Error{}const ha=new WeakMap;class ia{constructor(a,b){this.$name=a.name,this.$args=a.args,this.$value=a.value,this.$renderer=b,this.$scope=b.scope,this.$element=b.element;const c=m(j(a.value));this.$getter=a=>c(b.scope,Object.assign(Object.create(null),b.isolated,a)),this.init()}static get is(){return""}static match(){return!0}init(){}render(){}}ia._matcher=null,ia._match=function(a){const b=this._matcher.exec(a);return b&&b.groups};class ja extends ia{static get is(){return"*if"}init(){this.anchor=u(`if: ${this.$value}`)}render(){const{parentElement:a}=this.$element;this.$value?!a&&this.anchor.replaceWith(this.$element):a&&this.$element.replaceWith(this.anchor)}}class ka extends ia{static get is(){return"@<name>"}init(){const{$args:a,$scope:b,$name:c,$element:d}=this,e=a.includes("once");let f,g="addEventListener",h=a=>{b.$event=a,this.$getter(),b.$event=null};a.includes("self")&&(f=h,h=a=>{a.target===a.currentTarget&&f(a)}),a.includes("prevent")&&(f=h,h=a=>{a.preventDefault(),f(a)}),i(d)?g=`$on${e?"ce":""}`:e&&(f=h,h=a=>{d.removeEventListener(c,h),f(a)}),d[g](c,h)}}class la extends ia{static get is(){return".<name>"}init(){this._inCustom=i(this.$element),this.$element[this.$name]=null}render(){this.$element[this.$name]=this.$getter(),this._inCustom&&this.$element.$render()}}class ma extends ia{static get is(){return"ref"}init(){this.$scope.$refs||(this.$scope.$refs=new Map,this.$scope.$on("$render:before",()=>{this.$scope.$refs.clear()}))}render(){this.$element.isConnected&&this.$scope.$refs.set(this.$value,this.$element)}}class na extends ia{static get is(){return":<name>"}_getObserved(){let a=this.$element.getAttributeNode(this.$name);return H.debug||this.$element.removeAttribute(this.$name),a||(a=document.createAttribute(this.$name),this.$element.setAttributeNode(a)),a}init(){this.attribute=this._getObserved()}render(){const a=this.$getter();"boolean"==typeof a?this.element[`${a?"set":"remove"}AttributeNode`](this.attribute):w(this.attribute,a)&&(this.attribute.value=a)}}class oa extends na{static get is(){return":class"}_getNormalized(){const a=this.$getter();if(!Array.isArray(a))return a;return a.forEach(a=>{c(a)?Object.assign(result,a):result[a]=1}),{}}render(){const a=this._getNormalized();if(!c(a))return super.render();for(const b in a)a.hasOwnProperty(b)&&this.$element.classList[a[b]?"add":"remove"](b)}}class pa extends na{static get is(){return":style"}static parseRule(a){const b=a.split(".");return{prop:b[0],unit:b[1]}}init(){this.styles={}}render(){const a=this.$getter();if(!c(a))return super.render();const b=this.$element.attributeStyleMap;for(const c in this.styles)a.hasOwnProperty(c)||b.delete(pa.parseRule(c).prop);for(const c in a){const d=a[c];if(this.styles[c]!==d){const{prop:a,unit:e}=pa.parseRule(c);b.set(a,e?CSS[e](d):d)}}this.styles=Object.assign({},a)}}class qa extends ia{static get is(){return"*bind"}init(){this.setting=!1;const a=n(this.$value);this.setter=b=>{a(this.$scope,this.$renderer.isolated,b)},this.onInput&&this.$element.addEventListener("input",this.onInput.bind(this)),this.onChange&&this.$element.addEventListener("change",this.onChange.bind(this))}static setMultiple(a,b,c){const d=c.indexOf(b);a?-1===d&&c.push(b):-1<d&&c.splice(d,1)}setValue(a){this.setting=!0,this.setter(a)}render(){this.setting?this.setting=!1:this.update(this.$element,this.$getter())}}class ra extends qa{static match(a,{element:b}){return"checkbox"===b.type}onChange({target:a}){const b=this.$getter();return Array.isArray(b)?void qa.setMultiple(a.checked,a.value,b):this.setValue(a.checked)}update(a,b){a.checked=!!b}}class sa extends qa{static match(a,{element:b}){return"radio"===b.type}onChange({target:a}){a.checked&&this.setValue(a.value)}update(a,b){a.checked=b+""===a.value}}class ta extends qa{static match(a,{element:b}){return b instanceof HTMLInputElement||b instanceof HTMLTextAreaElement}init(){super.init(),this.conversor="number"===this.$element.type?Number:String}onInput({target:a}){this.setValue(this.conversor(a.value))}update(a,b){b=b+"",w(a,b)&&(a.value=b)}}class ua extends qa{static match(a,{element:b}){return b instanceof HTMLSelectElement}onChange({target:a}){const{options:b,multiple:c}=a;if(!c){for(const{value:a,selected:c}of b)if(c)return this.setValue(a);}else{const a=this.$getter();if(!Array.isArray(a))throw new ga("Invalid bound value. *bind directive on select elements with a `multiple` attribute must have an array bound value.");for(const c of b)qa.setMultiple(c.selected,c.value,a)}}update(a,b){for(const c of a.options)c.selected=a.multiple?-1<b.indexOf(c.value):b===c.value}}const va=D(HTMLElement);a.extend=D,a.config=H,a.GalaxyElement=va,a.html=function(...a){return F("template",...a)},a.css=function(...a){const b=F("style",...a);return b.setAttribute("skip",""),b},a.setup=E,Object.defineProperty(a,"__esModule",{value:!0})});