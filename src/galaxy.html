<script type="module">
  import config from './config.js'

  import Element from './Element.js'

  const Galaxy = {}

  // Setup configuration
  Galaxy.config = config

  Galaxy.Element = Element

  // Element registry
  Galaxy.elements = new Map()

  Galaxy.register = CustomElement => {
    return new Promise((resolve, reject) => {
      if (typeof CustomElement.is === 'undefined') {
        return reject(new GalaxyError('Unknown element name'))
      }

      try {
        customElements.define(CustomElement.is, CustomElement)
      } catch (e) {
        return reject(new GalaxyError(e.message))
      }

      customElements.whenDefined(CustomElement.is).then(() => {
        Galaxy.elements.set(CustomElement.is, CustomElement)
        resolve(CustomElement)
      })
    })
  }

  window.Galaxy = Galaxy
</script>
