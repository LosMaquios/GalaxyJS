<script type="module">
  import config from './config.js'

  import Element from './Element.js'
  import { registry } from './registry.js'

  const Galaxy = {}

  // Setup configuration
  Galaxy.config = config

  Galaxy.Element = Element

  // Element registry
  Galaxy.elements = registry

  Galaxy.register = async CustomElement => {
    // Patial solution: https://stackoverflow.com/a/41409299
    CustomElement.__CONTEXT__ = document.currentScript.ownerDocument

    if (typeof CustomElement.is === 'undefined') {
      throw new GalaxyError('Unknown element name')
    }

    try {
      customElements.define(CustomElement.is, CustomElement)
    } catch (e) {
      throw new GalaxyError(e.message)
    }

    // Await CE definition
    await customElements.whenDefined(CustomElement.is)

    // Local propietary registration
    Galaxy.elements.set(CustomElement.is, CustomElement)

    return CustomElement
  }

  window.Galaxy = Galaxy
</script>
