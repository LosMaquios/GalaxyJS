<link rel="import" href="../src/galaxy.html">
<link rel="import" href="./test-props.html">

<template>
  <style>
    :host .tomato {
      background: tomato;
    }
  </style>

  <h1 :id="title" class="classes other-class" :class="{ someClass: showClass }">{{ title | reverse }}</h1>
  <input type="text" *bind="title">

  <ul>
    <li>Wrapped (Start)</li>
    <li *for="todo in todos">
      {{ todo.name }}
      <input ::ref="'done' + $index" id="done-{{ $index }}" type="checkbox" @change="setTodoStatus(todo, $refs.get('done' + $index))">
      <button @click="removeTodo(todo)">&times;</button>
    </li>
    <li>Wrapped (End)</li>
  </ul>

  <h2>Letters</h2>

  <ul>
    <li *for="letter in letters">{{ $index + 1 }}. {{ letter }}</li>
  </ul>

  <div>
    <input type="text" *bind="todo.name">
    <button @click="console.log('Adding todo') || addTodo()">Add TODO</button>
  </div>

  {{{ html }}}

  <test-props :object="letters" string="Hello {{ title }}"></test-props>
</template>

<script>
  class TodoApp extends Galaxy.Element {
    constructor () {
      super()

      this.state = {
        showClass: false,
        title: 'Galaxy TODO APP',

        todo: {
          name: 'Testing Galaxy',
          done: false
        },

        todos: [
          {
            name: 'Make good things',
            done: false
          }
        ],

        letters: [
          'c', 'b', 'w',
          'j', 'z', 'a',
          'k', 'x', 'y'
        ],

        html: `
          <h2>Dynamic</h2>
          <p>Rendering HTML</p>
        `
      }

      setTimeout(() => {
        this.state.showClass = true
      }, 5000)
    }

    static get is () {
      return 'todo-app'
    }

    onCreated () {
      this.$channel.on('test-props', console.log)

      setTimeout(() => {
        this.state.letters.sort()
      }, 5000)
    }

    reverse (value) {
      return value.split('').reverse().join('')
    }

    addTodo ({ todos, todo }) {
      todos.push(Object.assign({}, todo))

      todo.name = ''
    }

    removeTodo ({ todos }, todo) {
      todos.splice(todos.indexOf(todo), 1)
    }

    setTodoStatus (_, todo, done) {
      todo.done = done.checked
    }
  }

  Galaxy.register(TodoApp)
</script>
